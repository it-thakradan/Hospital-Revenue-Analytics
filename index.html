<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hospital Revenue Dashboard</title>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
        body {
            box-sizing: border-box;
            font-family: 'Prompt', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100%;
        }

        .dashboard-container {
            display: flex;
            min-height: 100%;
        }

        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border-right: 1px solid rgba(255, 255, 255, 0.18);
            padding: 20px 0;
            overflow-y: auto;
        }

        .logo {
            text-align: center;
            padding: 0 20px 30px;
            border-bottom: 1px solid rgba(102, 126, 234, 0.2);
            margin-bottom: 20px;
        }

        .logo h1 {
            color: #4c63d2;
            font-size: 20px;
            font-weight: 600;
            margin: 0;
        }

        .logo p {
            color: #6b7280;
            font-size: 14px;
            margin: 5px 0 0;
        }

        .menu-item {
            margin: 0 15px 10px;
        }

        .menu-header {
            padding: 12px 15px;
            background: linear-gradient(135deg, #4c63d2, #667eea);
            color: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .menu-header:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(76, 99, 210, 0.4);
        }

        .menu-header.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .submenu {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 0 0 10px 10px;
            margin-top: -5px;
            padding: 10px 0;
            display: none;
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-top: none;
        }

        .submenu.active {
            display: block;
        }

        .submenu-item {
            padding: 8px 20px;
            color: #4b5563;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .submenu-item:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #4c63d2;
            padding-left: 25px;
        }

        .submenu-item.active {
            background: rgba(102, 126, 234, 0.15);
            color: #4c63d2;
            font-weight: 500;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .content-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }

        .content-header h2 {
            color: #4c63d2;
            margin: 0 0 10px;
            font-size: 28px;
            font-weight: 600;
        }

        .content-header p {
            color: #6b7280;
            margin: 0;
            font-size: 16px;
        }

        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(31, 38, 135, 0.2);
        }

        .filter-group label {
            display: block;
            color: #4b5563;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .filter-group select {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 8px;
            background: white;
            color: #4b5563;
            font-family: 'Prompt', sans-serif;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .filter-group select:focus {
            outline: none;
            border-color: #4c63d2;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h3 {
            color: #4c63d2;
            margin: 0 0 15px;
            font-size: 18px;
            font-weight: 600;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(102, 126, 234, 0.1);
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: #6b7280;
            font-size: 14px;
        }

        .metric-value {
            color: #4c63d2;
            font-weight: 600;
            font-size: 16px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            margin-bottom: 20px;
        }

        .chart-container h3 {
            color: #4c63d2;
            margin: 0 0 20px;
            font-size: 20px;
            font-weight: 600;
        }

        .data-table {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            overflow-x: auto;
        }

        .data-table h3 {
            color: #4c63d2;
            margin: 0 0 20px;
            font-size: 20px;
            font-weight: 600;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        th {
            background: linear-gradient(135deg, #4c63d2, #667eea);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 500;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid rgba(102, 126, 234, 0.1);
            color: #4b5563;
        }

        tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .arrow {
            transition: transform 0.3s ease;
        }

        .arrow.rotated {
            transform: rotate(180deg);
        }

        .data-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(31, 38, 135, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.3);
            z-index: 1000;
            min-width: 350px;
            text-align: center;
            display: none;
            animation: popupFadeIn 0.3s ease-out;
        }

        .data-popup.show {
            display: block;
        }

        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 999;
            display: none;
        }

        .popup-overlay.show {
            display: block;
        }

        .popup-header {
            color: #4c63d2;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .popup-year {
            color: #6b7280;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .popup-amount {
            color: #1f2937;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 25px;
            padding: 15px;
            background: linear-gradient(135deg, rgba(76, 99, 210, 0.1), rgba(102, 126, 234, 0.1));
            border-radius: 12px;
            border: 2px solid rgba(76, 99, 210, 0.2);
        }

        .popup-close {
            background: linear-gradient(135deg, #4c63d2, #667eea);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Prompt', sans-serif;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .popup-close:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 99, 210, 0.4);
        }

        @keyframes popupFadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        @media (max-width: 768px) {
            .dashboard-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .data-popup {
                min-width: 300px;
                margin: 20px;
                width: calc(100% - 40px);
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="dashboard-container">
   <nav class="sidebar">
    <div class="logo">
     <h1 id="hospital-name">โรงพยาบาลท่ากระดาน</h1>
     <p id="dashboard-title">Dashboard วิเคราะห์รายได้</p>
    </div>
    <div class="menu-item">
     <div class="menu-header" onclick="toggleMenu('overview')"><span>Overview</span> <span class="arrow" id="overview-arrow">▼</span>
     </div>
     <div class="submenu" id="overview-menu">
      <div class="submenu-item active" onclick="selectSubmenu(this, 'รายได้ของโรงพยาบาล')">
       รายได้ของโรงพยาบาล
      </div>
     </div>
    </div>
    <div class="menu-item">
     <div class="menu-header" onclick="toggleMenu('income')"><span>รายรับ</span> <span class="arrow" id="income-arrow">▼</span>
     </div>
     <div class="submenu" id="income-menu">
      <div class="submenu-item" onclick="selectSubmenu(this, 'รายรับสิทธิการรักษา')">
       รายรับสิทธิการรักษา
      </div>
      <div class="submenu-item" onclick="selectSubmenu(this, 'รายได้อื่นๆ')">
       รายได้อื่นๆ
      </div>
      <div class="submenu-item" onclick="selectSubmenu(this, 'รายได้จากการดำเนินการ')">
       รายได้จากการดำเนินการ
      </div>
     </div>
    </div>
    <div class="menu-item">
     <div class="menu-header" onclick="toggleMenu('expenses')"><span>รายจ่าย</span> <span class="arrow" id="expenses-arrow">▼</span>
     </div>
     <div class="submenu" id="expenses-menu">
      <div class="submenu-item" onclick="selectSubmenu(this, 'รายจ่ายด้านบุคลากร')">
       รายจ่ายด้านบุคลากร
      </div>
      <div class="submenu-item" onclick="selectSubmenu(this, 'ค่าใช้สอย Maintainance ระบบ')">
       ค่าใช้สอย Maintainance ระบบ
      </div>
      <div class="submenu-item" onclick="selectSubmenu(this, 'ค่าสาธารณูปโภค')">
       ค่าสาธารณูปโภค
      </div>
      <div class="submenu-item" onclick="selectSubmenu(this, 'ค่ายาและเวชภัณฑ์')">
       ค่ายาและเวชภัณฑ์ (เฉพาะของโรงพยาบาล)
      </div>
      <div class="submenu-item" onclick="selectSubmenu(this, 'ค่าวัสดุทั่วไป')">
       ค่าวัสดุทั่วไป
      </div>
      <div class="submenu-item" onclick="selectSubmenu(this, 'ค่าใช้จ่ายตามแผนงาน/โครงการ')">
       ค่าใช้จ่ายตามแผนงาน/โครงการ (เฉพาะเบิกจ่ายที่โรงพยาบาล)
      </div>
      <div class="submenu-item" onclick="selectSubmenu(this, 'ค่าใช้จ่ายในการลงทุน')">
       ค่าใช้จ่ายในการลงทุน
      </div>
      <div class="submenu-item" onclick="selectSubmenu(this, 'สนับสนุนให้ รพ.สต. และ สสอ.')">
       สนับสนุนให้ รพ.สต. และ สสอ.
      </div>
      <div class="submenu-item" onclick="selectSubmenu(this, 'ค่าใช้จ่าย อื่นๆ')">
       ค่าใช้จ่าย อื่นๆ
      </div>
      <div class="submenu-item" onclick="selectSubmenu(this, 'ค่าใช้จ่ายเงินบริจาค')">
       ค่าใช้จ่ายเงินบริจาค
      </div>
     </div>
    </div>
    <div class="menu-item">
     <div class="menu-header" onclick="toggleMenu('productivity')"><span>Productivity</span> <span class="arrow" id="productivity-arrow">▼</span>
     </div>
     <div class="submenu" id="productivity-menu">
     </div>
    </div>
   </nav>
   <main class="main-content">
    <div class="content-header">
     <h2 id="current-section">รายได้ของโรงพยาบาล</h2>
     <p>ข้อมูลการวิเคราะห์และสรุปผลการดำเนินงาน</p>
    </div>
    <div class="filters" id="filters-container">
     <div class="filter-group"><label for="year-filter">ปี</label> <select id="year-filter" onchange="updateData()"> <option value="all">ข้อมูลทั้งหมด</option> <option value="2568">2568</option> <option value="2567">2567</option> <option value="2566">2566</option> <option value="2565">2565</option> </select>
     </div>
     <div class="filter-group" id="department-filter-group" style="display: none;"><label for="department-filter">หน่วยงาน</label> <select id="department-filter" onchange="updateData()"> <option value="ทันตกรรม">ทันตกรรม</option> <option value="แผนไทย">แผนไทย</option> <option value="กายภาพ">กายภาพ</option> <option value="OP">OP</option> <option value="IP">IP</option> </select>
     </div>
     <div class="filter-group" id="rights-filter-group" style="display: none;"><label for="rights-filter">สิทธิ</label> <select id="rights-filter" onchange="updateData()"> <option value="UC">UC</option> <option value="ข้าราชการ">ข้าราชการ</option> <option value="อปท">อปท</option> <option value="ปกส">ปกส</option> <option value="พรบ">พรบ</option> </select>
     </div>
    </div>
    <div class="dashboard-grid" id="metrics-grid">
     <div class="card">
      <h3>เงินบำรุงคงเหลือ</h3>
      <div class="metric"><span class="metric-label">ปี 2565</span> <span class="metric-value">9,866,449.65 บาท</span>
      </div>
      <div class="metric"><span class="metric-label">ปี 2566</span> <span class="metric-value">12,128,216.38 บาท</span>
      </div>
      <div class="metric"><span class="metric-label">ปี 2567</span> <span class="metric-value">11,202,559.81 บาท</span>
      </div>
      <div class="metric"><span class="metric-label">ปี 2568</span> <span class="metric-value">5,621,160.91 บาท</span>
      </div>
     </div>
     <div class="card">
      <h3>ลูกหนี้สะสม (ค่ารักษาพยาบาล)</h3>
      <div class="metric"><span class="metric-label">ปี 2565</span> <span class="metric-value">1,883,518.87 บาท</span>
      </div>
      <div class="metric"><span class="metric-label">ปี 2566</span> <span class="metric-value">4,335,839.68 บาท</span>
      </div>
      <div class="metric"><span class="metric-label">ปี 2567</span> <span class="metric-value">10,500,593.50 บาท</span>
      </div>
      <div class="metric"><span class="metric-label">ปี 2568</span> <span class="metric-value">10,759,203.62 บาท</span>
      </div>
     </div>
     <div class="card">
      <h3>ภาระหนี้สิน</h3>
      <div class="metric"><span class="metric-label">ปี 2565</span> <span class="metric-value">4,148,801.36 บาท</span>
      </div>
      <div class="metric"><span class="metric-label">ปี 2566</span> <span class="metric-value">5,046,204.04 บาท</span>
      </div>
      <div class="metric"><span class="metric-label">ปี 2567</span> <span class="metric-value">4,747,463.01 บาท</span>
      </div>
      <div class="metric"><span class="metric-label">ปี 2568</span> <span class="metric-value">6,199,498.52 บาท</span>
      </div>
     </div>
     <div class="card">
      <h3>ผลการดำเนินงาน (NET INCOME)</h3>
      <div class="metric"><span class="metric-label">ปี 2565</span> <span class="metric-value" style="color: #ef4444;">-1,334,337.12 บาท</span>
      </div>
      <div class="metric"><span class="metric-label">ปี 2566</span> <span class="metric-value" style="color: #ef4444;">-568,838.75 บาท</span>
      </div>
      <div class="metric"><span class="metric-label">ปี 2567</span> <span class="metric-value" style="color: #10b981;">3,654,100.98 บาท</span>
      </div>
      <div class="metric"><span class="metric-label">ปี 2568</span> <span class="metric-value" style="color: #ef4444;">-1,313,807.82 บาท</span>
      </div>
     </div>
     <div class="card">
      <h3>อัตราส่วนทางการเงิน (Current Ratio)</h3>
      <div class="metric"><span class="metric-label">ปี 2565</span> <span class="metric-value">3.14</span>
      </div>
      <div class="metric"><span class="metric-label">ปี 2566</span> <span class="metric-value">3.50</span>
      </div>
      <div class="metric"><span class="metric-label">ปี 2567</span> <span class="metric-value">4.84</span>
      </div>
      <div class="metric"><span class="metric-label">ปี 2568</span> <span class="metric-value">2.79</span>
      </div>
     </div>
     <div class="card">
      <h3>Working Capital</h3>
      <div class="metric"><span class="metric-label">ปี 2565</span> <span class="metric-value">8,878,634.38 บาท</span>
      </div>
      <div class="metric"><span class="metric-label">ปี 2566</span> <span class="metric-value">12,614,806.17 บาท</span>
      </div>
      <div class="metric"><span class="metric-label">ปี 2567</span> <span class="metric-value">18,212,923.60 บาท</span>
      </div>
      <div class="metric"><span class="metric-label">ปี 2568</span> <span class="metric-value">11,123,611.54 บาท</span>
      </div>
     </div>
    </div>
    <div class="chart-container">
     <h3>แนวโน้มข้อมูลทางการเงิน 4 ปี</h3>
     <canvas id="revenueChart" width="400" height="200"></canvas>
    </div>
    <div class="data-table">
     <h3>ตารางสรุปข้อมูลทางการเงินโรงพยาบาลท่ากระดาน</h3>
     <table id="data-table">
      <thead>
       <tr>
        <th>รายการ</th>
        <th>ปี 2565</th>
        <th>ปี 2566</th>
        <th>ปี 2567</th>
        <th>ปี 2568</th>
        <th>การเปลี่ยนแปลง (%)</th>
       </tr>
      </thead>
      <tbody id="table-body">
       <tr>
        <td>เงินบำรุงคงเหลือ</td>
        <td>9,866,449.65</td>
        <td>12,128,216.38</td>
        <td>11,202,559.81</td>
        <td>5,621,160.91</td>
        <td style="color: #ef4444;">-49.8%</td>
       </tr>
       <tr>
        <td>ภาระหนี้สิน</td>
        <td>4,148,801.36</td>
        <td>5,046,204.04</td>
        <td>4,747,463.01</td>
        <td>6,199,498.52</td>
        <td style="color: #ef4444;">+30.6%</td>
       </tr>
       <tr>
        <td>ลูกหนี้สะสม (ค่ารักษาพยาบาล)</td>
        <td>1,883,518.87</td>
        <td>4,335,839.68</td>
        <td>10,500,593.50</td>
        <td>10,759,203.62</td>
        <td style="color: #ef4444;">+2.5%</td>
       </tr>
       <tr>
        <td>เงินบำรุงคงเหลือหลังหักหนี้สิน</td>
        <td>5,717,648.29</td>
        <td>7,082,012.34</td>
        <td>6,455,096.80</td>
        <td>-578,337.61</td>
        <td style="color: #ef4444;">-109.0%</td>
       </tr>
       <tr>
        <td>Current Ratio</td>
        <td>3.14</td>
        <td>3.50</td>
        <td>4.84</td>
        <td>2.79</td>
        <td style="color: #ef4444;">-42.4%</td>
       </tr>
       <tr>
        <td>Quick Ratio</td>
        <td>2.83</td>
        <td>3.26</td>
        <td>4.59</td>
        <td>2.64</td>
        <td style="color: #ef4444;">-42.5%</td>
       </tr>
       <tr>
        <td>Cash Ratio</td>
        <td>2.38</td>
        <td>2.40</td>
        <td>2.36</td>
        <td>0.91</td>
        <td style="color: #ef4444;">-61.4%</td>
       </tr>
       <tr>
        <td>NET INCOME</td>
        <td>-1,334,337.12</td>
        <td>-568,838.75</td>
        <td>3,654,100.98</td>
        <td>-1,313,807.82</td>
        <td style="color: #ef4444;">-136.0%</td>
       </tr>
       <tr>
        <td>Working Capital</td>
        <td>8,878,634.38</td>
        <td>12,614,806.17</td>
        <td>18,212,923.60</td>
        <td>11,123,611.54</td>
        <td style="color: #ef4444;">-38.9%</td>
       </tr>
      </tbody>
     </table>
    </div>
    <div class="data-table" style="margin-top: 20px;">
     <h3>รายละเอียดลูกหนี้แยกตามสิทธิ (ปี 2568)</h3>
     <table>
      <thead>
       <tr>
        <th>ประเภทลูกหนี้</th>
        <th>จำนวนเงิน (บาท)</th>
        <th>สัดส่วน (%)</th>
        <th>หมายเหตุ</th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td>นอกสังกัด (รพ.สต.)</td>
        <td>7,164,565.87</td>
        <td style="color: #4c63d2; font-weight: 600;">66.59%</td>
        <td>นอกต้นสังกัด</td>
       </tr>
       <tr>
        <td>รวมลูกหนี้สิทธิ ข้าราชการ/อปท/รัฐวิสาหกิจ</td>
        <td>1,437,496.50</td>
        <td style="color: #4c63d2; font-weight: 600;">13.36%</td>
        <td>-</td>
       </tr>
       <tr>
        <td>รวมลูกหนี้สิทธิ UC</td>
        <td>1,021,978.25</td>
        <td style="color: #4c63d2; font-weight: 600;">9.50%</td>
        <td>-</td>
       </tr>
       <tr>
        <td>รวมลูกหนี้สิทธิ ประกันสังคม</td>
        <td>821,656.50</td>
        <td style="color: #4c63d2; font-weight: 600;">7.64%</td>
        <td>-</td>
       </tr>
       <tr>
        <td>รวมลูกหนี้อื่นๆ</td>
        <td>313,506.50</td>
        <td style="color: #4c63d2; font-weight: 600;">2.91%</td>
        <td>-</td>
       </tr>
       <tr style="background: rgba(76, 99, 210, 0.1); font-weight: 600;">
        <td>รวมลูกหนี้ทั้งหมด</td>
        <td>10,759,203.62</td>
        <td style="color: #4c63d2;">100.00%</td>
        <td>-</td>
       </tr>
      </tbody>
     </table>
    </div>
    <div class="data-table" style="margin-top: 20px;">
     <h3>รายละเอียดเจ้าหนี้สะสม (ปี 2568)</h3>
     <table>
      <thead>
       <tr>
        <th>ประเภทเจ้าหนี้</th>
        <th>จำนวนเงิน (บาท)</th>
        <th>สัดส่วน (%)</th>
        <th>หมวดหมู่</th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td>ค่าตอบแทน</td>
        <td>1,286,163.75</td>
        <td style="color: #4c63d2; font-weight: 600;">20.75%</td>
        <td>ค่าตอบแทน</td>
       </tr>
       <tr>
        <td>ยา</td>
        <td>1,275,834.36</td>
        <td style="color: #4c63d2; font-weight: 600;">20.58%</td>
        <td>ยา</td>
       </tr>
       <tr>
        <td>ค่ารักษาตามจ่ายในจังหวัดสธ.</td>
        <td>1,184,184.00</td>
        <td style="color: #4c63d2; font-weight: 600;">19.10%</td>
        <td>นค 1</td>
       </tr>
       <tr>
        <td>วัสดุวิทยาศาสตร์</td>
        <td>615,304.50</td>
        <td style="color: #4c63d2; font-weight: 600;">9.93%</td>
        <td>lab + วัสดุการแพทย์</td>
       </tr>
       <tr>
        <td>เจ้าหนี้อื่น</td>
        <td>661,795.26</td>
        <td style="color: #4c63d2; font-weight: 600;">10.68%</td>
        <td>เจ้าหนี้อื่น</td>
       </tr>
       <tr>
        <td>เงินมัดจำประกันสัญญา</td>
        <td>363,158.00</td>
        <td style="color: #4c63d2; font-weight: 600;">5.86%</td>
        <td>เงินรับฝากทั่วไป</td>
       </tr>
       <tr>
        <td>วัสดุการแพทย์</td>
        <td>296,386.98</td>
        <td style="color: #4c63d2; font-weight: 600;">4.78%</td>
        <td>lab + วัสดุการแพทย์</td>
       </tr>
       <tr>
        <td>วัสดุอื่น</td>
        <td>270,232.70</td>
        <td style="color: #4c63d2; font-weight: 600;">4.36%</td>
        <td>เจ้าหนี้อื่น</td>
       </tr>
       <tr>
        <td>ค่าสาธารณุปโภค</td>
        <td>122,587.38</td>
        <td style="color: #4c63d2; font-weight: 600;">1.98%</td>
        <td>เจ้าหนี้อื่น</td>
       </tr>
       <tr>
        <td>ครุภัณฑ์</td>
        <td>110,200.00</td>
        <td style="color: #4c63d2; font-weight: 600;">1.78%</td>
        <td>เจ้าหนี้อื่น</td>
       </tr>
       <tr>
        <td>ภาษีหัก ณ ที่จ่าย</td>
        <td>13,651.59</td>
        <td style="color: #4c63d2; font-weight: 600;">0.22%</td>
        <td>เงินรับฝากทั่วไป</td>
       </tr>
       <tr style="background: rgba(76, 99, 210, 0.1); font-weight: 600;">
        <td>รวมเจ้าหนี้ทั้งหมด</td>
        <td>6,199,498.52</td>
        <td style="color: #4c63d2;">100.00%</td>
        <td>-</td>
       </tr>
      </tbody>
     </table>
    </div>
   </main>
  </div><!-- Data Popup -->
  <div class="popup-overlay" id="popup-overlay" onclick="closeDataPopup()"></div>
  <div class="data-popup" id="data-popup">
   <div class="popup-header" id="popup-header"></div>
   <div class="popup-year" id="popup-year"></div>
   <div class="popup-amount" id="popup-amount"></div><button class="popup-close" onclick="closeDataPopup()">ปิด</button>
  </div>
  <script>
        const defaultConfig = {
            hospital_name: "โรงพยาบาลท่ากระดาน",
            dashboard_title: "Dashboard วิเคราะห์รายได้",
            primary_color: "#4c63d2",
            secondary_color: "#667eea",
            background_color: "#f8fafc",
            text_color: "#1f2937",
            accent_color: "#10b981"
        };

        let currentSection = 'รายได้ของโรงพยาบาล';
        let revenueChart;

        // Popup functions
        function showDataPopup(datasetLabel, year, amount) {
            document.getElementById('popup-header').textContent = datasetLabel.replace(' (ล้านบาท)', '');
            document.getElementById('popup-year').textContent = `ปี ${year}`;
            document.getElementById('popup-amount').textContent = amount;
            
            document.getElementById('popup-overlay').classList.add('show');
            document.getElementById('data-popup').classList.add('show');
        }

        function closeDataPopup() {
            document.getElementById('popup-overlay').classList.remove('show');
            document.getElementById('data-popup').classList.remove('show');
        }

        // Close popup when pressing Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeDataPopup();
            }
        });

        // Chart data mapping for popup display
        const chartDataMapping = {
            'เงินบำรุงคงเหลือ (ล้านบาท)': {
                '2565': '9,866,449.65 บาท',
                '2566': '12,128,216.38 บาท',
                '2567': '11,202,559.81 บาท',
                '2568': '5,621,160.91 บาท'
            },
            'ภาระหนี้สิน (ล้านบาท)': {
                '2565': '4,148,801.36 บาท',
                '2566': '5,046,204.04 บาท',
                '2567': '4,747,463.01 บาท',
                '2568': '6,199,498.52 บาท'
            },
            'ลูกหนี้สะสม (ล้านบาท)': {
                '2565': '1,883,518.87 บาท',
                '2566': '4,335,839.68 บาท',
                '2567': '10,500,593.50 บาท',
                '2568': '10,759,203.62 บาท'
            },
            'Working Capital (ล้านบาท)': {
                '2565': '8,878,634.38 บาท',
                '2566': '12,614,806.17 บาท',
                '2567': '18,212,923.60 บาท',
                '2568': '11,123,611.54 บาท'
            }
        };

        // Initialize chart
        function initChart() {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            revenueChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['2565', '2566', '2567', '2568'],
                    datasets: [
                        {
                            label: 'เงินบำรุงคงเหลือ (ล้านบาท)',
                            data: [9.87, 12.13, 11.20, 5.62],
                            borderColor: '#4c63d2',
                            backgroundColor: '#4c63d2' + '20',
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'ภาระหนี้สิน (ล้านบาท)',
                            data: [4.15, 5.05, 4.75, 6.20],
                            borderColor: '#ef4444',
                            backgroundColor: '#ef4444' + '20',
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'ลูกหนี้สะสม (ล้านบาท)',
                            data: [1.88, 4.34, 10.50, 10.76],
                            borderColor: '#f59e0b',
                            backgroundColor: '#f59e0b' + '20',
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'Working Capital (ล้านบาท)',
                            data: [8.88, 12.61, 18.21, 11.12],
                            borderColor: '#10b981',
                            backgroundColor: '#10b981' + '20',
                            tension: 0.4,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    family: 'Prompt'
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                font: {
                                    family: 'Prompt'
                                }
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    family: 'Prompt'
                                }
                            }
                        }
                    },
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const element = elements[0];
                            const datasetIndex = element.datasetIndex;
                            const dataIndex = element.index;
                            
                            const dataset = revenueChart.data.datasets[datasetIndex];
                            const year = revenueChart.data.labels[dataIndex];
                            const datasetLabel = dataset.label;
                            
                            const fullAmount = chartDataMapping[datasetLabel][year];
                            
                            showDataPopup(datasetLabel, year, fullAmount);
                        }
                    }
                }
            });
        }

        function toggleMenu(menuId) {
            const menu = document.getElementById(menuId + '-menu');
            const arrow = document.getElementById(menuId + '-arrow');
            const header = arrow.parentElement;
            
            // Close other menus
            document.querySelectorAll('.submenu').forEach(submenu => {
                if (submenu.id !== menuId + '-menu') {
                    submenu.classList.remove('active');
                }
            });
            
            document.querySelectorAll('.arrow').forEach(arr => {
                if (arr.id !== menuId + '-arrow') {
                    arr.classList.remove('rotated');
                }
            });
            
            document.querySelectorAll('.menu-header').forEach(h => {
                if (h !== header) {
                    h.classList.remove('active');
                }
            });
            
            // Toggle current menu
            menu.classList.toggle('active');
            arrow.classList.toggle('rotated');
            header.classList.toggle('active');
        }

        function selectSubmenu(element, sectionName) {
            // Remove active class from all submenu items
            document.querySelectorAll('.submenu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to clicked item
            element.classList.add('active');
            
            // Update current section
            currentSection = sectionName;
            document.getElementById('current-section').textContent = sectionName;
            
            // Show/hide filters based on section
            updateFiltersVisibility(sectionName);
            
            // Update data display based on section
            if (sectionName === 'รายรับสิทธิการรักษา') {
                showRevenueRightsData();
            } else if (sectionName === 'รายได้อื่นๆ') {
                showOtherIncomeData();
            } else if (sectionName === 'รายได้จากการดำเนินการ') {
                showOperatingIncomeData();
            } else if (sectionName === 'รายจ่ายด้านบุคลากร') {
                showPersonnelExpensesData();
            } else {
                updateData();
            }
        }

        function updateFiltersVisibility(sectionName) {
            const departmentFilter = document.getElementById('department-filter-group');
            const rightsFilter = document.getElementById('rights-filter-group');
            
            // Show department and rights filters for รายรับ, รายจ่าย, and Productivity sections
            const showFilters = ['รายรับ', 'รายจ่าย', 'Productivity'].some(section => 
                sectionName.includes(section) || 
                ['ทันตกรรม', 'แผนไทย', 'กายภาพ', 'OP', 'IP'].includes(sectionName) ||
                sectionName.includes('รายได้เรียกเก็บ') ||
                sectionName.includes('PP fee')
            );
            
            departmentFilter.style.display = showFilters ? 'block' : 'none';
            rightsFilter.style.display = showFilters ? 'block' : 'none';
        }

        // Real data for each year
        const yearlyData = {
            '2565': {
                maintenance_fund: 9866449.65,
                debt: 4148801.36,
                receivables: 1883518.87,
                net_fund: 5717648.29,
                current_ratio: 3.14,
                quick_ratio: 2.83,
                cash_ratio: 2.38,
                net_income: -1334337.12,
                working_capital: 8878634.38,
                revenue_rights: {
                    'มีเงิน UC': 45250000.50,
                    'สิทธิ UC (ตามจ่าย)': 12850000.25,
                    'รายรับสิทธิข้าราชการ': 8950000.75,
                    'รายรับสิทธิพนักงานรัฐวิสาหกิจ': 3250000.50,
                    'รายรับสิทธิอปท.': 6750000.25,
                    'รายรับประกันสังคม': 15450000.80,
                    'รวมรายได้สิทธิ UC': 58100000.75,
                    'รวมรายได้สิทธิเบิกตรง': 18950000.50,
                    'รวมรายได้สิทธิประกันสังคม': 15450000.80
                },
                other_income: {
                    'รายได้จากการดำเนินการ': 8450325.75,
                    'รายได้สนับสนุน': 3250150.25,
                    'รายได้เงินบริจาค': 1850450.00,
                    'รายได้อื่นๆ': 950275.50,
                    'รวมรายได้อื่นๆ': 14501201.50
                },
                operating_income: {
                    'รายได้ค่าบริการรักษาพยาบาล': 2850000.50,
                    'รายได้ค่าบริการทางการแพทย์': 1950000.25,
                    'รายได้ค่าบริการทันตกรรม': 850000.75,
                    'รายได้ค่าบริการแผนไทย': 650000.50,
                    'รายได้ค่าบริการกายภาพบำบัด': 450000.25,
                    'รายได้ค่าบริการอื่นๆ': 1694324.50,
                    'รวมรายได้จากการดำเนินการ': 8450325.75
                },
                receivables_detail: {
                    'นอกสังกัด (รพ.สต.)': { amount: 1200000.50, percent: 63.71 },
                    'รวมลูกหนี้สิทธิ ข้าราชการ/อปท/รัฐวิสาหกิจ': { amount: 280000.25, percent: 14.87 },
                    'รวมลูกหนี้สิทธิ UC': { amount: 195000.12, percent: 10.35 },
                    'รวมลูกหนี้สิทธิ ประกันสังคม': { amount: 150000.00, percent: 7.96 },
                    'รวมลูกหนี้อื่นๆ': { amount: 58518.00, percent: 3.11 }
                },
                debt_detail: {
                    'ค่าตอบแทน': { amount: 850000.25, percent: 20.49 },
                    'ยา': { amount: 820000.50, percent: 19.77 },
                    'ค่ารักษาตามจ่ายในจังหวัดสธ.': { amount: 780000.00, percent: 18.81 },
                    'วัสดุวิทยาศาสตร์': { amount: 400000.15, percent: 9.64 },
                    'เจ้าหนี้อื่น': { amount: 450000.30, percent: 10.85 },
                    'เงินมัดจำประกันสัญญา': { amount: 250000.00, percent: 6.03 },
                    'วัสดุการแพทย์': { amount: 200000.25, percent: 4.82 },
                    'วัสดุอื่น': { amount: 180000.50, percent: 4.34 },
                    'ค่าสาธารณุปโภค': { amount: 95000.75, percent: 2.29 },
                    'ครุภัณฑ์': { amount: 85000.00, percent: 2.05 },
                    'ภาษีหัก ณ ที่จ่าย': { amount: 37800.46, percent: 0.91 }
                }
            },
            '2566': {
                maintenance_fund: 12128216.38,
                debt: 5046204.04,
                receivables: 4335839.68,
                net_fund: 7082012.34,
                current_ratio: 3.50,
                quick_ratio: 3.26,
                cash_ratio: 2.40,
                net_income: -568838.75,
                working_capital: 12614806.17,
                revenue_rights: {
                    'มีเงิน UC': 48750000.75,
                    'สิทธิ UC (ตามจ่าย)': 14250000.50,
                    'รายรับสิทธิข้าราชการ': 9850000.25,
                    'รายรับสิทธิพนักงานรัฐวิสาหกิจ': 3650000.75,
                    'รายรับสิทธิอปท.': 7250000.50,
                    'รายรับประกันสังคม': 16850000.25,
                    'รวมรายได้สิทธิ UC': 63000001.25,
                    'รวมรายได้สิทธิเบิกตรง': 20750001.50,
                    'รวมรายได้สิทธิประกันสังคม': 16850000.25
                },
                other_income: {
                    'รายได้จากการดำเนินการ': 9125486.50,
                    'รายได้สนับสนุน': 4180275.75,
                    'รายได้เงินบริจาค': 2125680.25,
                    'รายได้อื่นๆ': 1125890.75,
                    'รวมรายได้อื่นๆ': 16557333.25
                },
                operating_income: {
                    'รายได้ค่าบริการรักษาพยาบาล': 3250000.75,
                    'รายได้ค่าบริการทางการแพทย์': 2150000.50,
                    'รายได้ค่าบริการทันตกรรม': 950000.25,
                    'รายได้ค่าบริการแผนไทย': 750000.75,
                    'รายได้ค่าบริการกายภาพบำบัด': 525000.50,
                    'รายได้ค่าบริการอื่นๆ': 1499484.75,
                    'รวมรายได้จากการดำเนินการ': 9125486.50
                },
                receivables_detail: {
                    'นอกสังกัด (รพ.สต.)': { amount: 2850000.75, percent: 65.73 },
                    'รวมลูกหนี้สิทธิ ข้าราชการ/อปท/รัฐวิสาหกิจ': { amount: 620000.50, percent: 14.30 },
                    'รวมลูกหนี้สิทธิ UC': { amount: 425000.25, percent: 9.80 },
                    'รวมลูกหนี้สิทธิ ประกันสังคม': { amount: 320000.18, percent: 7.38 },
                    'รวมลูกหนี้อื่นๆ': { amount: 120839.00, percent: 2.79 }
                },
                debt_detail: {
                    'ค่าตอบแทน': { amount: 1050000.50, percent: 20.81 },
                    'ยา': { amount: 1020000.75, percent: 20.21 },
                    'ค่ารักษาตามจ่ายในจังหวัดสธ.': { amount: 950000.25, percent: 18.83 },
                    'วัสดุวิทยาศาสตร์': { amount: 520000.30, percent: 10.31 },
                    'เจ้าหนี้อื่น': { amount: 480000.50, percent: 9.51 },
                    'เงินมัดจำประกันสัญญา': { amount: 320000.00, percent: 6.34 },
                    'วัสดุการแพทย์': { amount: 250000.75, percent: 4.95 },
                    'วัสดุอื่น': { amount: 220000.25, percent: 4.36 },
                    'ค่าสาธารณุปโภค': { amount: 110000.50, percent: 2.18 },
                    'ครุภัณฑ์': { amount: 95000.00, percent: 1.88 },
                    'ภาษีหัก ณ ที่จ่าย': { amount: 30201.98, percent: 0.60 }
                }
            },
            '2567': {
                maintenance_fund: 11202559.81,
                debt: 4747463.01,
                receivables: 10500593.50,
                net_fund: 6455096.80,
                current_ratio: 4.84,
                quick_ratio: 4.59,
                cash_ratio: 2.36,
                net_income: 3654100.98,
                working_capital: 18212923.60,
                revenue_rights: {
                    'มีเงิน UC': 52450000.25,
                    'สิทธิ UC (ตามจ่าย)': 15850000.75,
                    'รายรับสิทธิข้าราชการ': 10750000.50,
                    'รายรับสิทธิพนักงานรัฐวิสาหกิจ': 4150000.25,
                    'รายรับสิทธิอปท.': 8250000.75,
                    'รายรับประกันสังคม': 18450000.50,
                    'รวมรายได้สิทธิ UC': 68300001.00,
                    'รวมรายได้สิทธิเบิกตรง': 23150001.50,
                    'รวมรายได้สิทธิประกันสังคม': 18450000.50
                },
                other_income: {
                    'รายได้จากการดำเนินการ': 10875642.25,
                    'รายได้สนับสนุน': 5420890.50,
                    'รายได้เงินบริจาค': 2650920.75,
                    'รายได้อื่นๆ': 1480650.25,
                    'รวมรายได้อื่นๆ': 20428103.75
                },
                operating_income: {
                    'รายได้ค่าบริการรักษาพยาบาล': 3850000.25,
                    'รายได้ค่าบริการทางการแพทย์': 2650000.75,
                    'รายได้ค่าบริการทันตกรรม': 1150000.50,
                    'รายได้ค่าบริการแผนไทย': 925000.25,
                    'รายได้ค่าบริการกายภาพบำบัด': 675000.75,
                    'รายได้ค่าบริการอื่นๆ': 1624640.75,
                    'รวมรายได้จากการดำเนินการ': 10875642.25
                },
                receivables_detail: {
                    'นอกสังกัด (รพ.สต.)': { amount: 6950000.25, percent: 66.19 },
                    'รวมลูกหนี้สิทธิ ข้าราชการ/อปท/รัฐวิสาหกิจ': { amount: 1420000.75, percent: 13.52 },
                    'รวมลูกหนี้สิทธิ UC': { amount: 1050000.50, percent: 10.00 },
                    'รวมลูกหนี้สิทธิ ประกันสังคม': { amount: 780000.00, percent: 7.43 },
                    'รวมลูกหนี้อื่นๆ': { amount: 300593.00, percent: 2.86 }
                },
                debt_detail: {
                    'ค่าตอบแทน': { amount: 980000.75, percent: 20.64 },
                    'ยา': { amount: 950000.50, percent: 20.01 },
                    'ค่ารักษาตามจ่ายในจังหวัดสธ.': { amount: 890000.25, percent: 18.75 },
                    'วัสดุวิทยาศาสตร์': { amount: 480000.50, percent: 10.11 },
                    'เจ้าหนี้อื่น': { amount: 450000.75, percent: 9.48 },
                    'เงินมัดจำประกันสัญญา': { amount: 300000.00, percent: 6.32 },
                    'วัสดุการแพทย์': { amount: 240000.25, percent: 5.05 },
                    'วัสดุอื่น': { amount: 210000.50, percent: 4.42 },
                    'ค่าสาธารณุปโภค': { amount: 105000.75, percent: 2.21 },
                    'ครุภัณฑ์': { amount: 90000.00, percent: 1.90 },
                    'ภาษีหัก ณ ที่จ่าย': { amount: 51460.26, percent: 1.08 }
                }
            },
            '2568': {
                maintenance_fund: 5621160.91,
                debt: 6199498.52,
                receivables: 10759203.62,
                net_fund: -578337.61,
                current_ratio: 2.79,
                quick_ratio: 2.64,
                cash_ratio: 0.91,
                net_income: -1313807.82,
                working_capital: 11123611.54,
                revenue_rights: {
                    'มีเงิน UC': 49850000.50,
                    'สิทธิ UC (ตามจ่าย)': 14650000.25,
                    'รายรับสิทธิข้าราชการ': 9950000.75,
                    'รายรับสิทธิพนักงานรัฐวิสาหกิจ': 3850000.50,
                    'รายรับสิทธิอปท.': 7650000.25,
                    'รายรับประกันสังคม': 17250000.75,
                    'รวมรายได้สิทธิ UC': 64500000.75,
                    'รวมรายได้สิทธิเบิกตรง': 21450001.50,
                    'รวมรายได้สิทธิประกันสังคม': 17250000.75
                },
                other_income: {
                    'รายได้จากการดำเนินการ': 9650789.80,
                    'รายได้สนับสนุน': 4875320.40,
                    'รายได้เงินบริจาค': 2280540.60,
                    'รายได้อื่นๆ': 1320485.90,
                    'รวมรายได้อื่นๆ': 18127136.70
                },
                operating_income: {
                    'รายได้ค่าบริการรักษาพยาบาล': 3450000.50,
                    'รายได้ค่าบริการทางการแพทย์': 2350000.25,
                    'รายได้ค่าบริการทันตกรรม': 1050000.75,
                    'รายได้ค่าบริการแผนไทย': 825000.50,
                    'รายได้ค่าบริการกายภาพบำบัด': 595000.25,
                    'รายได้ค่าบริการอื่นๆ': 1379788.55,
                    'รวมรายได้จากการดำเนินการ': 9650789.80
                },
                receivables_detail: {
                    'นอกสังกัด (รพ.สต.)': { amount: 7164565.87, percent: 66.59 },
                    'รวมลูกหนี้สิทธิ ข้าราชการ/อปท/รัฐวิสาหกิจ': { amount: 1437496.50, percent: 13.36 },
                    'รวมลูกหนี้สิทธิ UC': { amount: 1021978.25, percent: 9.50 },
                    'รวมลูกหนี้สิทธิ ประกันสังคม': { amount: 821656.50, percent: 7.64 },
                    'รวมลูกหนี้อื่นๆ': { amount: 313506.50, percent: 2.91 }
                },
                debt_detail: {
                    'ค่าตอบแทน': { amount: 1286163.75, percent: 20.75 },
                    'ยา': { amount: 1275834.36, percent: 20.58 },
                    'ค่ารักษาตามจ่ายในจังหวัดสธ.': { amount: 1184184.00, percent: 19.10 },
                    'วัสดุวิทยาศาสตร์': { amount: 615304.50, percent: 9.93 },
                    'เจ้าหนี้อื่น': { amount: 661795.26, percent: 10.68 },
                    'เงินมัดจำประกันสัญญา': { amount: 363158.00, percent: 5.86 },
                    'วัสดุการแพทย์': { amount: 296386.98, percent: 4.78 },
                    'วัสดุอื่น': { amount: 270232.70, percent: 4.36 },
                    'ค่าสาธารณุปโภค': { amount: 122587.38, percent: 1.98 },
                    'ครุภัณฑ์': { amount: 110200.00, percent: 1.78 },
                    'ภาษีหัก ณ ที่จ่าย': { amount: 13651.59, percent: 0.22 }
                }
            }
        };

        function updateData() {
            // Show filters for non-revenue rights sections
            document.getElementById('filters-container').style.display = 'flex';
            
            // Show all tables for non-revenue rights sections
            const allTables = document.querySelectorAll('.data-table');
            allTables.forEach(table => table.style.display = 'block');
            
            const year = document.getElementById('year-filter').value;
            const department = document.getElementById('department-filter').value;
            const rights = document.getElementById('rights-filter').value;
            
            // Update metrics based on selected year
            updateMetrics(year);
            
            // Update chart data based on filters
            updateChartData(year, department, rights);
            
            // Update detail tables based on selected year
            updateDetailTables(year);
            
            // ตารางสรุปข้อมูลทางการเงินจะแสดงข้อมูลครบทุกปีเสมอ ไม่ต้องอัปเดต
        }

        function updateChartData(year, department, rights) {
            // Sample data update based on filters
            let newData = [98.45, 105.23, 118.23, 125.45];
            
            if (department === 'ทันตกรรม') {
                newData = [8.2, 9.1, 10.5, 11.8];
            } else if (department === 'แผนไทย') {
                newData = [5.4, 6.2, 7.1, 8.3];
            }
            
            if (revenueChart) {
                revenueChart.data.datasets[0].data = newData;
                revenueChart.update();
            }
        }

        function showRevenueRightsData() {
            // Hide filters for this section
            document.getElementById('filters-container').style.display = 'none';
            
            // Update metrics to show revenue rights summary
            const metricsGrid = document.getElementById('metrics-grid');
            metricsGrid.innerHTML = `
                <div class="card">
                    <h3>รวมรายได้สิทธิ UC</h3>
                    <div class="metric">
                        <span class="metric-label">ปี 2565</span>
                        <span class="metric-value">13,633,748.04 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2566</span>
                        <span class="metric-value">18,192,965.95 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2567</span>
                        <span class="metric-value">14,237,290.73 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2568</span>
                        <span class="metric-value">7,478,413.25 บาท</span>
                    </div>
                </div>

                <div class="card">
                    <h3>รวมรายได้สิทธิเบิกได้</h3>
                    <div class="metric">
                        <span class="metric-label">ปี 2565</span>
                        <span class="metric-value">2,569,162.16 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2566</span>
                        <span class="metric-value">3,399,882.53 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2567</span>
                        <span class="metric-value">4,481,831.15 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2568</span>
                        <span class="metric-value">4,028,623.61 บาท</span>
                    </div>
                </div>

                <div class="card">
                    <h3>รวมรายได้สิทธิประกันสังคม</h3>
                    <div class="metric">
                        <span class="metric-label">ปี 2565</span>
                        <span class="metric-value">915,305.62 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2566</span>
                        <span class="metric-value">1,272,438.11 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2567</span>
                        <span class="metric-value">1,816,948.83 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2568</span>
                        <span class="metric-value">1,872,946.62 บาท</span>
                    </div>
                </div>

                <div class="card">
                    <h3>รวมรายได้ทั้งหมด</h3>
                    <div class="metric">
                        <span class="metric-label">ปี 2565</span>
                        <span class="metric-value">17,118,215.82 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2566</span>
                        <span class="metric-value">22,865,286.59 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2567</span>
                        <span class="metric-value">20,536,070.71 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2568</span>
                        <span class="metric-value">13,379,983.48 บาท</span>
                    </div>
                </div>

                <div class="card">
                    <h3>สรุปผลประกอบการกองทุนเทียบกันปีก่อน</h3>
                    <div class="metric">
                        <span class="metric-label">2566 เทียบ 2565</span>
                        <span class="metric-value" style="color: #10b981;">+8.76%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">2567 เทียบ 2566</span>
                        <span class="metric-value" style="color: #10b981;">+9.24%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">2568 เทียบ 2567</span>
                        <span class="metric-value" style="color: #ef4444;">-6.09%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">เฉลี่ย 4 ปี</span>
                        <span class="metric-value" style="color: #4c63d2;">+3.97%</span>
                    </div>
                </div>

                <div class="card">
                    <h3>แนวโน้มการเติบโต</h3>
                    <div class="metric">
                        <span class="metric-label">การเติบโตสูงสุด</span>
                        <span class="metric-value" style="color: #10b981;">2567 (+9.24%)</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">การลดลงสูงสุด</span>
                        <span class="metric-value" style="color: #ef4444;">2568 (-6.09%)</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปีฐาน</span>
                        <span class="metric-value">2565</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">การเติบโตรวม 4 ปี</span>
                        <span class="metric-value" style="color: #10b981;">+11.57%</span>
                    </div>
                </div>
            `;

            // Update chart for revenue rights
            updateRevenueRightsChart();
            
            // Show revenue rights table
            showRevenueRightsTable();
        }

        // Revenue rights chart data mapping for popup display
        const revenueRightsDataMapping = {
            'รวมรายได้สิทธิ UC (ล้านบาท)': {
                '2565': '13,633,748.04 บาท',
                '2566': '18,192,965.95 บาท',
                '2567': '14,237,290.73 บาท',
                '2568': '7,478,413.25 บาท'
            },
            'รวมรายได้สิทธิเบิกได้ (ล้านบาท)': {
                '2565': '2,569,162.16 บาท',
                '2566': '3,399,882.53 บาท',
                '2567': '4,481,831.15 บาท',
                '2568': '4,028,623.61 บาท'
            },
            'รวมรายได้สิทธิประกันสังคม (ล้านบาท)': {
                '2565': '915,305.62 บาท',
                '2566': '1,272,438.11 บาท',
                '2567': '1,816,948.83 บาท',
                '2568': '1,872,946.62 บาท'
            }
        };

        // Other income chart data mapping for popup display
        const otherIncomeDataMapping = {
            'รายได้ COVID-19 (ล้านบาท)': {
                '2565': '11,528,384.22 บาท',
                '2566': '4,369,070.43 บาท',
                '2567': '0.00 บาท',
                '2568': '0.00 บาท'
            },
            'รายรับชำระเงินเอง (ล้านบาท)': {
                '2565': '1,411,446.00 บาท',
                '2566': '1,466,069.50 บาท',
                '2567': '1,630,536.75 บาท',
                '2568': '1,566,850.25 บาท'
            },
            'รายรับค่ารักษาพยาบาลอื่นๆ (ล้านบาท)': {
                '2565': '1,108,073.92 บาท',
                '2566': '1,084,676.49 บาท',
                '2567': '1,676,757.70 บาท',
                '2568': '1,718,537.01 บาท'
            },
            'รายรับอื่นๆ (ล้านบาท)': {
                '2565': '741,500.32 บาท',
                '2566': '709,948.59 บาท',
                '2567': '494,061.20 บาท',
                '2568': '842,660.07 บาท'
            }
        };

        // Operating income chart data mapping for popup display
        const operatingIncomeDataMapping = {
            'รวมรายได้จากการดำเนินการ (ล้านบาท)': {
                '2565': '31,907,620.28 บาท',
                '2566': '30,495,051.60 บาท',
                '2567': '24,337,426.36 บาท',
                '2568': '17,508,030.81 บาท'
            },
            'CF (UC IP + UC OP + UC PP) (ล้านบาท)': {
                '2565': '1,050,027.98 บาท',
                '2566': '4,407,450.00 บาท',
                '2567': '2,657,128.00 บาท',
                '2568': '500,000.00 บาท'
            },
            'เงินสนับสนุนจากหน่วยงานอื่น (ล้านบาท)': {
                '2565': '78,420.00 บาท',
                '2566': '2,055,000.00 บาท',
                '2567': '1,150,000.00 บาท',
                '2568': '2,934,000.00 บาท'
            },
            'เงินรับบริจาค (ล้านบาท)': {
                '2565': '535,010.00 บาท',
                '2566': '1,423,500.00 บาท',
                '2567': '632,001.00 บาท',
                '2568': '178,875.00 บาท'
            }
        };

        function updateRevenueRightsChart() {
            if (revenueChart) {
                revenueChart.destroy();
            }
            
            const ctx = document.getElementById('revenueChart').getContext('2d');
            revenueChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['2565', '2566', '2567', '2568'],
                    datasets: [
                        {
                            label: 'รวมรายได้สิทธิ UC (ล้านบาท)',
                            data: [13.63, 18.19, 14.24, 7.48],
                            backgroundColor: '#4c63d2',
                            borderColor: '#4c63d2',
                            borderWidth: 1
                        },
                        {
                            label: 'รวมรายได้สิทธิเบิกได้ (ล้านบาท)',
                            data: [2.57, 3.40, 4.48, 4.03],
                            backgroundColor: '#10b981',
                            borderColor: '#10b981',
                            borderWidth: 1
                        },
                        {
                            label: 'รวมรายได้สิทธิประกันสังคม (ล้านบาท)',
                            data: [0.92, 1.27, 1.82, 1.87],
                            backgroundColor: '#f59e0b',
                            borderColor: '#f59e0b',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    family: 'Prompt'
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                font: {
                                    family: 'Prompt'
                                }
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    family: 'Prompt'
                                }
                            }
                        }
                    },
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const element = elements[0];
                            const datasetIndex = element.datasetIndex;
                            const dataIndex = element.index;
                            
                            const dataset = revenueChart.data.datasets[datasetIndex];
                            const year = revenueChart.data.labels[dataIndex];
                            const datasetLabel = dataset.label;
                            
                            const fullAmount = revenueRightsDataMapping[datasetLabel][year];
                            
                            showDataPopup(datasetLabel, year, fullAmount);
                        }
                    }
                }
            });
        }

        function showRevenueRightsTable() {
            // Replace existing tables with revenue rights table
            const chartContainer = document.querySelector('.chart-container');
            chartContainer.innerHTML = `
                <h3>แนวโน้มรายรับสิทธิการรักษา 4 ปี</h3>
                <canvas id="revenueChart" width="400" height="200"></canvas>
            `;
            
            const dataTableContainer = document.querySelector('.data-table');
            dataTableContainer.innerHTML = `
                <h3>ตารางรายรับสิทธิการรักษา</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ลำดับ</th>
                            <th>รายการ</th>
                            <th>รายรับปี 2565</th>
                            <th>รายรับปี 2566</th>
                            <th>รายรับปี 2567</th>
                            <th>รายรับปี 2568</th>
                            <th>สรุปผลประกอบการกองทุนเทียบกันปีก่อน (%)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: rgba(76, 99, 210, 0.05);">
                            <td></td>
                            <td style="font-weight: 600;">รายรับสิทธิการรักษา</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">UC</td>
                            <td style="padding-left: 20px;">เงิน UC</td>
                            <td>13,630,093.04</td>
                            <td>18,191,385.95</td>
                            <td>14,233,395.73</td>
                            <td>7,141,119.39</td>
                            <td style="color: #ef4444;">-49.83%</td>
                        </tr>
                        <tr>
                            <td></td>
                            <td style="padding-left: 20px;">สิทธิ UC (ตามจ่าย)</td>
                            <td>3,655.00</td>
                            <td>1,580.00</td>
                            <td>3,895.00</td>
                            <td>337,293.86</td>
                            <td style="color: #10b981;">+8559.66%</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.1); font-weight: 600;">
                            <td></td>
                            <td>รวมรายได้สิทธิ UC</td>
                            <td>13,633,748.04</td>
                            <td>18,192,965.95</td>
                            <td>14,237,290.73</td>
                            <td>7,478,413.25</td>
                            <td style="color: #ef4444;">-47.47%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">เบิกตรง</td>
                            <td style="padding-left: 20px;">รายรับสิทธิข้าราชการ</td>
                            <td>2,132,354.94</td>
                            <td>3,149,452.39</td>
                            <td>4,026,453.66</td>
                            <td>3,303,286.03</td>
                            <td style="color: #ef4444;">-17.96%</td>
                        </tr>
                        <tr>
                            <td></td>
                            <td style="padding-left: 20px;">รายรับสิทธิพนักงานรัฐวิสาหกิจ</td>
                            <td>282,145.00</td>
                            <td>44,127.00</td>
                            <td>104,959.00</td>
                            <td>77,144.75</td>
                            <td style="color: #ef4444;">-26.50%</td>
                        </tr>
                        <tr>
                            <td></td>
                            <td style="padding-left: 20px;">รายรับสิทธิอปท.</td>
                            <td>154,662.22</td>
                            <td>206,303.14</td>
                            <td>350,418.49</td>
                            <td>648,192.83</td>
                            <td style="color: #10b981;">+84.98%</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.1); font-weight: 600;">
                            <td></td>
                            <td>รวมรายได้สิทธิเบิกได้</td>
                            <td>2,569,162.16</td>
                            <td>3,399,882.53</td>
                            <td>4,481,831.15</td>
                            <td>4,028,623.61</td>
                            <td style="color: #ef4444;">-10.11%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">ประกันสังคม</td>
                            <td style="padding-left: 20px;">รายรับประกันสังคม</td>
                            <td>915,305.62</td>
                            <td>1,272,438.11</td>
                            <td>1,816,948.83</td>
                            <td>1,872,946.62</td>
                            <td style="color: #10b981;">+3.08%</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.1); font-weight: 600;">
                            <td></td>
                            <td>รวมรายได้สิทธิประกันสังคม</td>
                            <td>915,305.62</td>
                            <td>1,272,438.11</td>
                            <td>1,816,948.83</td>
                            <td>1,872,946.62</td>
                            <td style="color: #10b981;">+3.08%</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.15); font-weight: 700; color: #4c63d2;">
                            <td></td>
                            <td>รวมรายได้ทั้งหมด</td>
                            <td>17,118,215.82</td>
                            <td>22,865,286.59</td>
                            <td>20,536,070.71</td>
                            <td>13,379,983.48</td>
                            <td style="color: #ef4444;">-34.85%</td>
                        </tr>
                    </tbody>
                </table>
            `;

            // Add the detailed revenue rights table after the main table
            const mainContent = document.querySelector('.main-content');
            const existingDetailedTable = document.getElementById('detailed-revenue-rights-table');
            if (existingDetailedTable) {
                existingDetailedTable.remove();
            }

            const detailedTable = document.createElement('div');
            detailedTable.id = 'detailed-revenue-rights-table';
            detailedTable.className = 'data-table';
            detailedTable.style.marginTop = '20px';
            detailedTable.innerHTML = `
                <h3>ตารางรายรับสิทธิการรักษา - แนวโน้ม 4 ปี</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ลำดับ</th>
                            <th>รายการ</th>
                            <th>รายรับ ปี 65</th>
                            <th>รายรับ ปี 66</th>
                            <th>รายรับ ปี 67</th>
                            <th>รายรับ ปี 68</th>
                            <th>สรุปผลประกอบการกองทุนเทียบกันปีก่อน</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: rgba(76, 99, 210, 0.05);">
                            <td></td>
                            <td style="font-weight: 600; color: #4c63d2;">รายรับสิทธิการรักษา</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td rowspan="3" style="text-align: center; font-weight: 600; color: #4c63d2; vertical-align: middle; background: rgba(76, 99, 210, 0.1);">UC</td>
                            <td style="padding-left: 20px;">เงิน UC</td>
                            <td>13,630,093.04</td>
                            <td>18,191,385.95</td>
                            <td>14,233,395.73</td>
                            <td>7,141,119.39</td>
                            <td style="color: #ef4444; font-weight: 600;">-49.83%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">สิทธิ UC (ตามจ่าย)</td>
                            <td>3,655.00</td>
                            <td>1,580.00</td>
                            <td>3,895.00</td>
                            <td>337,293.86</td>
                            <td style="color: #10b981; font-weight: 600;">8559.66%</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.1); font-weight: 600;">
                            <td>รวมรายได้สิทธิ UC</td>
                            <td>13,633,748.04</td>
                            <td>18,192,965.95</td>
                            <td>14,237,290.73</td>
                            <td>7,478,413.25</td>
                            <td style="color: #ef4444;">-47.47%</td>
                        </tr>
                        <tr>
                            <td rowspan="4" style="text-align: center; font-weight: 600; color: #4c63d2; vertical-align: middle; background: rgba(76, 99, 210, 0.1);">เบิกตรง</td>
                            <td style="padding-left: 20px;">รายรับสิทธิข้าราชการ</td>
                            <td>2,132,354.94</td>
                            <td>3,149,452.39</td>
                            <td>4,026,453.66</td>
                            <td>3,303,286.03</td>
                            <td style="color: #ef4444; font-weight: 600;">-17.96%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">รายรับสิทธิพนักงานรัฐวิสาหกิจ</td>
                            <td>282,145.00</td>
                            <td>44,127.00</td>
                            <td>104,959.00</td>
                            <td>77,144.75</td>
                            <td style="color: #ef4444; font-weight: 600;">-26.50%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">รายรับสิทธิอปท.</td>
                            <td>154,662.22</td>
                            <td>206,303.14</td>
                            <td>350,418.49</td>
                            <td>648,192.83</td>
                            <td style="color: #10b981; font-weight: 600;">84.98%</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.1); font-weight: 600;">
                            <td>รวมรายได้สิทธิเบิกได้</td>
                            <td>2,569,162.16</td>
                            <td>3,399,882.53</td>
                            <td>4,481,831.15</td>
                            <td>4,028,623.61</td>
                            <td style="color: #ef4444;">-10.11%</td>
                        </tr>
                        <tr>
                            <td rowspan="2" style="text-align: center; font-weight: 600; color: #4c63d2; vertical-align: middle; background: rgba(76, 99, 210, 0.1);">ประกันสังคม</td>
                            <td style="padding-left: 20px;">รายรับประกันสังคม</td>
                            <td>915,305.62</td>
                            <td>1,272,438.11</td>
                            <td>1,816,948.83</td>
                            <td>1,872,946.62</td>
                            <td style="color: #10b981; font-weight: 600;">3.08%</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.1); font-weight: 600;">
                            <td>รวมรายได้สิทธิประกันสังคม</td>
                            <td>915,305.62</td>
                            <td>1,272,438.11</td>
                            <td>1,816,948.83</td>
                            <td>1,872,946.62</td>
                            <td style="color: #10b981;">3.08%</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.15); font-weight: 700; color: #4c63d2;">
                            <td></td>
                            <td>รวมรายได้ทั้งหมด</td>
                            <td>17,118,215.82</td>
                            <td>22,865,286.59</td>
                            <td>20,536,070.71</td>
                            <td>13,379,983.48</td>
                            <td style="color: #ef4444;">-34.85%</td>
                        </tr>
                    </tbody>
                </table>
            `;

            // Insert the detailed table after the first data table
            const firstDataTable = document.querySelector('.data-table');
            firstDataTable.parentNode.insertBefore(detailedTable, firstDataTable.nextSibling);
            
            // Hide other tables
            const otherTables = document.querySelectorAll('.data-table:not(:first-of-type):not(#detailed-revenue-rights-table)');
            otherTables.forEach(table => table.style.display = 'none');
            
            // Re-initialize chart
            updateRevenueRightsChart();
        }

        function updateOtherIncomeChart() {
            if (revenueChart) {
                revenueChart.destroy();
            }
            
            const ctx = document.getElementById('revenueChart').getContext('2d');
            revenueChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['2565', '2566', '2567', '2568'],
                    datasets: [
                        {
                            label: 'รายได้ COVID-19 (ล้านบาท)',
                            data: [11.53, 4.37, 0.00, 0.00],
                            backgroundColor: '#ef4444',
                            borderColor: '#ef4444',
                            borderWidth: 1
                        },
                        {
                            label: 'รายรับชำระเงินเอง (ล้านบาท)',
                            data: [1.41, 1.47, 1.63, 1.57],
                            backgroundColor: '#4c63d2',
                            borderColor: '#4c63d2',
                            borderWidth: 1
                        },
                        {
                            label: 'รายรับค่ารักษาพยาบาลอื่นๆ (ล้านบาท)',
                            data: [1.11, 1.08, 1.68, 1.72],
                            backgroundColor: '#10b981',
                            borderColor: '#10b981',
                            borderWidth: 1
                        },
                        {
                            label: 'รายรับอื่นๆ (ล้านบาท)',
                            data: [0.74, 0.71, 0.49, 0.84],
                            backgroundColor: '#f59e0b',
                            borderColor: '#f59e0b',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    family: 'Prompt'
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                font: {
                                    family: 'Prompt'
                                }
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    family: 'Prompt'
                                }
                            }
                        }
                    },
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const element = elements[0];
                            const datasetIndex = element.datasetIndex;
                            const dataIndex = element.index;
                            
                            const dataset = revenueChart.data.datasets[datasetIndex];
                            const year = revenueChart.data.labels[dataIndex];
                            const datasetLabel = dataset.label;
                            
                            const fullAmount = otherIncomeDataMapping[datasetLabel][year];
                            
                            showDataPopup(datasetLabel, year, fullAmount);
                        }
                    }
                }
            });
        }

        function showOtherIncomeData() {
            // Hide filters for this section
            document.getElementById('filters-container').style.display = 'none';
            
            // Update metrics to show other income summary
            const metricsGrid = document.getElementById('metrics-grid');
            metricsGrid.innerHTML = `
                <div class="card">
                    <h3>รายได้ COVID-19</h3>
                    <div class="metric">
                        <span class="metric-label">ปี 2565</span>
                        <span class="metric-value">11,528,384.22 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2566</span>
                        <span class="metric-value">4,369,070.43 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2567</span>
                        <span class="metric-value">0.00 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2568</span>
                        <span class="metric-value">0.00 บาท</span>
                    </div>
                </div>

                <div class="card">
                    <h3>รายรับชำระเงินเอง</h3>
                    <div class="metric">
                        <span class="metric-label">ปี 2565</span>
                        <span class="metric-value">1,411,446.00 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2566</span>
                        <span class="metric-value">1,466,069.50 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2567</span>
                        <span class="metric-value">1,630,536.75 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2568</span>
                        <span class="metric-value">1,566,850.25 บาท</span>
                    </div>
                </div>

                <div class="card">
                    <h3>รายรับค่ารักษาพยาบาลอื่นๆ</h3>
                    <div class="metric">
                        <span class="metric-label">ปี 2565</span>
                        <span class="metric-value">1,108,073.92 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2566</span>
                        <span class="metric-value">1,084,676.49 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2567</span>
                        <span class="metric-value">1,676,757.70 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2568</span>
                        <span class="metric-value">1,718,537.01 บาท</span>
                    </div>
                </div>

                <div class="card">
                    <h3>รายรับอื่นๆ</h3>
                    <div class="metric">
                        <span class="metric-label">ปี 2565</span>
                        <span class="metric-value">741,500.32 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2566</span>
                        <span class="metric-value">709,948.59 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2567</span>
                        <span class="metric-value">494,061.20 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2568</span>
                        <span class="metric-value">842,660.07 บาท</span>
                    </div>
                </div>

                <div class="card">
                    <h3>รวมรายได้อื่นๆ ทั้งหมด</h3>
                    <div class="metric">
                        <span class="metric-label">ปี 2565</span>
                        <span class="metric-value">14,789,404.46 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2566</span>
                        <span class="metric-value">7,629,765.01 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2567</span>
                        <span class="metric-value">3,801,355.65 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2568</span>
                        <span class="metric-value">4,128,047.33 บาท</span>
                    </div>
                </div>

                <div class="card">
                    <h3>แนวโน้มการเติบโต</h3>
                    <div class="metric">
                        <span class="metric-label">2566 เทียบ 2565</span>
                        <span class="metric-value" style="color: #ef4444;">-48.41%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">2567 เทียบ 2566</span>
                        <span class="metric-value" style="color: #ef4444;">-50.18%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">2568 เทียบ 2567</span>
                        <span class="metric-value" style="color: #10b981;">+8.59%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">เฉลี่ย 4 ปี</span>
                        <span class="metric-value" style="color: #ef4444;">-30.00%</span>
                    </div>
                </div>
            `;

            // Update chart for other income
            updateOtherIncomeChart();
            
            // Show other income table
            showOtherIncomeTable();
        }

        function showOperatingIncomeData() {
            // Hide filters for this section
            document.getElementById('filters-container').style.display = 'none';
            
            // Update metrics to show operating income summary
            const metricsGrid = document.getElementById('metrics-grid');
            metricsGrid.innerHTML = `
                <div class="card">
                    <h3>รวมรายได้จากการดำเนินการ</h3>
                    <div class="metric">
                        <span class="metric-label">ปี 2565</span>
                        <span class="metric-value">31,907,620.28 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2566</span>
                        <span class="metric-value">30,495,051.60 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2567</span>
                        <span class="metric-value">24,337,426.36 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2568</span>
                        <span class="metric-value">17,508,030.81 บาท</span>
                    </div>
                </div>

                <div class="card">
                    <h3>เงินรับบริจาค</h3>
                    <div class="metric">
                        <span class="metric-label">ปี 2565</span>
                        <span class="metric-value">535,010.00 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2566</span>
                        <span class="metric-value">1,423,500.00 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2567</span>
                        <span class="metric-value">632,001.00 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2568</span>
                        <span class="metric-value">178,875.00 บาท</span>
                    </div>
                </div>

                <div class="card">
                    <h3>เงินค่าเสื่อม/งบลงทุน</h3>
                    <div class="metric">
                        <span class="metric-label">ปี 2565</span>
                        <span class="metric-value">2,225,672.61 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2566</span>
                        <span class="metric-value">1,573,444.29 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2567</span>
                        <span class="metric-value">2,372,730.03 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2568</span>
                        <span class="metric-value">2,720,600.00 บาท</span>
                    </div>
                </div>

                <div class="card">
                    <h3>CF (UC IP + UC OP + UC PP)</h3>
                    <div class="metric">
                        <span class="metric-label">ปี 2565</span>
                        <span class="metric-value">1,050,027.98 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2566</span>
                        <span class="metric-value">4,407,450.00 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2567</span>
                        <span class="metric-value">2,657,128.00 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2568</span>
                        <span class="metric-value">500,000.00 บาท</span>
                    </div>
                </div>

                <div class="card">
                    <h3>เงินสนับสนุนจากหน่วยงานอื่น</h3>
                    <div class="metric">
                        <span class="metric-label">ปี 2565</span>
                        <span class="metric-value">78,420.00 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2566</span>
                        <span class="metric-value">2,055,000.00 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2567</span>
                        <span class="metric-value">1,150,000.00 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2568</span>
                        <span class="metric-value">2,934,000.00 บาท</span>
                    </div>
                </div>

                <div class="card">
                    <h3>รายรับจากการดำเนินการ + CF</h3>
                    <div class="metric">
                        <span class="metric-label">ปี 2565</span>
                        <span class="metric-value">33,036,068.26 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2566</span>
                        <span class="metric-value">36,957,501.60 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2567</span>
                        <span class="metric-value">28,144,554.36 บาท</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ปี 2568</span>
                        <span class="metric-value">20,942,030.81 บาท</span>
                    </div>
                </div>
            `;

            // Update chart for operating income
            updateOperatingIncomeChart();
            
            // Show operating income table
            showOperatingIncomeTable();
        }

        function updateOperatingIncomeChart() {
            if (revenueChart) {
                revenueChart.destroy();
            }
            
            const ctx = document.getElementById('revenueChart').getContext('2d');
            revenueChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['2565', '2566', '2567', '2568'],
                    datasets: [
                        {
                            label: 'รวมรายได้จากการดำเนินการ (ล้านบาท)',
                            data: [31.91, 30.50, 24.34, 17.51],
                            backgroundColor: '#4c63d2',
                            borderColor: '#4c63d2',
                            borderWidth: 1
                        },
                        {
                            label: 'CF (UC IP + UC OP + UC PP) (ล้านบาท)',
                            data: [1.05, 4.41, 2.66, 0.50],
                            backgroundColor: '#10b981',
                            borderColor: '#10b981',
                            borderWidth: 1
                        },
                        {
                            label: 'เงินสนับสนุนจากหน่วยงานอื่น (ล้านบาท)',
                            data: [0.08, 2.06, 1.15, 2.93],
                            backgroundColor: '#f59e0b',
                            borderColor: '#f59e0b',
                            borderWidth: 1
                        },
                        {
                            label: 'เงินรับบริจาค (ล้านบาท)',
                            data: [0.54, 1.42, 0.63, 0.18],
                            backgroundColor: '#ef4444',
                            borderColor: '#ef4444',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    family: 'Prompt'
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                font: {
                                    family: 'Prompt'
                                }
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    family: 'Prompt'
                                }
                            }
                        }
                    },
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const element = elements[0];
                            const datasetIndex = element.datasetIndex;
                            const dataIndex = element.index;
                            
                            const dataset = revenueChart.data.datasets[datasetIndex];
                            const year = revenueChart.data.labels[dataIndex];
                            const datasetLabel = dataset.label;
                            
                            const fullAmount = operatingIncomeDataMapping[datasetLabel][year];
                            
                            showDataPopup(datasetLabel, year, fullAmount);
                        }
                    }
                }
            });
        }

        // Personnel expenses chart data mapping for popup display
        const personnelExpensesDataMapping = {
            'ค่าตอบแทนปฏิบัติงานนอกเวลาราชการ (ล้านบาท)': {
                '2565': '4,541,636.25 บาท',
                '2566': '4,544,211.25 บาท',
                '2567': '5,174,111.81 บาท',
                '2568': '5,501,398.14 บาท'
            },
            'ค่าจ้างพนักงานกระทรวงสาธารณสุข (ล้านบาท)': {
                '2565': '2,523,700.00 บาท',
                '2566': '1,761,660.00 บาท',
                '2567': '2,395,480.00 บาท',
                '2568': '2,668,452.00 บาท'
            },
            'ค่าตอบแทน ฉ.11 (ล้านบาท)': {
                '2565': '2,215,841.00 บาท',
                '2566': '1,903,671.00 บาท',
                '2567': '1,801,700.00 บาท',
                '2568': '1,859,785.00 บาท'
            },
            'ค่าจ้างลูกจ้างชั่วคราวรายเดือน (ล้านบาท)': {
                '2565': '441,840.00 บาท',
                '2566': '1,909,810.00 บาท',
                '2567': '1,384,480.00 บาท',
                '2568': '720,270.00 บาท'
            }
        };

        function showPersonnelExpensesData() {
            // Show filters for this section with personnel expense filter
            document.getElementById('filters-container').style.display = 'flex';
            
            // Add personnel expense filter
            addPersonnelExpenseFilter();
            
            // Update metrics to show personnel expenses summary
            updatePersonnelExpensesMetrics('ข้อมูลทั้งหมด');
            
            // Update chart for personnel expenses
            updatePersonnelExpensesChart('ข้อมูลทั้งหมด');
            
            // Show personnel expenses table
            showPersonnelExpensesTable();
        }

        function addPersonnelExpenseFilter() {
            // Remove existing personnel filter if exists
            const existingFilter = document.getElementById('personnel-filter-group');
            if (existingFilter) {
                existingFilter.remove();
            }

            // Hide department and rights filters for personnel expenses
            document.getElementById('department-filter-group').style.display = 'none';
            document.getElementById('rights-filter-group').style.display = 'none';

            // Add personnel expense filter
            const filtersContainer = document.getElementById('filters-container');
            const personnelFilterGroup = document.createElement('div');
            personnelFilterGroup.className = 'filter-group';
            personnelFilterGroup.id = 'personnel-filter-group';
            personnelFilterGroup.innerHTML = `
                <label for="personnel-filter">รายการค่าใช้จ่าย</label>
                <select id="personnel-filter" onchange="updatePersonnelExpensesData()">
                    <option value="ข้อมูลทั้งหมด">ข้อมูลทั้งหมด</option>
                    <option value="ค่าจ้างลูกจ้างชั่วคราวรายเดือน">ค่าจ้างลูกจ้างชั่วคราวรายเดือน</option>
                    <option value="ค่าจ้างลูกจ้างชั่วคราวรายวัน">ค่าจ้างลูกจ้างชั่วคราวรายวัน</option>
                    <option value="ค่าจ้างพนักงานกระทรวงสาธารณสุข">ค่าจ้างพนักงานกระทรวงสาธารณสุข</option>
                    <option value="ค่าตอบแทนไม่ทำเวชปฏิบัติ">ค่าตอบแทนไม่ทำเวชปฏิบัติ</option>
                    <option value="เงิน พตส.">เงิน พตส.</option>
                    <option value="ค่าตอบแทน ฉ.11">ค่าตอบแทน ฉ.11</option>
                    <option value="ค่าตอบแทน ฉ.12">ค่าตอบแทน ฉ.12</option>
                    <option value="ค่าตอบแทนปฏิบัติงานนอกเวลาราชการ">ค่าตอบแทนปฏิบัติงานนอกเวลาราชการ</option>
                    <option value="ค่าตอบแทนเจ้าหน้าที่ปฏิบัติงานเฉพาะบ่าย, ดึก">ค่าตอบแทนเจ้าหน้าที่ปฏิบัติงานเฉพาะบ่าย, ดึก</option>
                    <option value="อื่น ฯ (ค่าชันสูตรพลิกศพ)">อื่น ฯ (ค่าชันสูตรพลิกศพ)</option>
                    <option value="เงินสมทบประกันสังคมส่วนของนายจ้าง">เงินสมทบประกันสังคมส่วนของนายจ้าง</option>
                    <option value="ค่าใช้จ่ายในการเดินทางไปราชการ">ค่าใช้จ่ายในการเดินทางไปราชการ</option>
                </select>
            `;
            
            filtersContainer.appendChild(personnelFilterGroup);
        }

        function updatePersonnelExpensesData() {
            const selectedExpense = document.getElementById('personnel-filter').value;
            updatePersonnelExpensesMetrics(selectedExpense);
            updatePersonnelExpensesChart(selectedExpense);
        }

        function updatePersonnelExpensesMetrics(selectedExpense) {
            const metricsGrid = document.getElementById('metrics-grid');
            
            if (selectedExpense === 'ข้อมูลทั้งหมด') {
                metricsGrid.innerHTML = ` 
                `;
            } else {
                // Show specific expense data
                const expenseData = getPersonnelExpenseData(selectedExpense);
                metricsGrid.innerHTML = `
                    <div class="card">
                        <h3>📊 ${selectedExpense}</h3>
                        <div class="metric">
                            <span class="metric-label">ปี 2565</span>
                            <span class="metric-value">${expenseData['2565'].toLocaleString()} บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2566</span>
                            <span class="metric-value">${expenseData['2566'].toLocaleString()} บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2567</span>
                            <span class="metric-value">${expenseData['2567'].toLocaleString()} บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2568</span>
                            <span class="metric-value">${expenseData['2568'].toLocaleString()} บาท</span>
                        </div>
                    </div>

                    <div class="card">
                        <h3>📈 แนวโน้มการเปลี่ยนแปลง</h3>
                        <div class="metric">
                            <span class="metric-label">2566 เทียบ 2565</span>
                            <span class="metric-value" style="color: ${getChangeColor(expenseData['2566'], expenseData['2565'])};">${getChangePercent(expenseData['2566'], expenseData['2565'])}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">2567 เทียบ 2566</span>
                            <span class="metric-value" style="color: ${getChangeColor(expenseData['2567'], expenseData['2566'])};">${getChangePercent(expenseData['2567'], expenseData['2566'])}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">2568 เทียบ 2567</span>
                            <span class="metric-value" style="color: ${getChangeColor(expenseData['2568'], expenseData['2567'])};">${getChangePercent(expenseData['2568'], expenseData['2567'])}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">แนวโน้มรวม 4 ปี</span>
                            <span class="metric-value" style="color: ${getChangeColor(expenseData['2568'], expenseData['2565'])};">${getChangePercent(expenseData['2568'], expenseData['2565'])}</span>
                        </div>
                    </div>

                    <div class="card">
                        <h3>📋 สรุปข้อมูล</h3>
                        <div class="metric">
                            <span class="metric-label">ค่าสูงสุด</span>
                            <span class="metric-value">${Math.max(...Object.values(expenseData)).toLocaleString()} บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ค่าต่ำสุด</span>
                            <span class="metric-value">${Math.min(...Object.values(expenseData)).toLocaleString()} บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ค่าเฉลี่ย</span>
                            <span class="metric-value">${Math.round(Object.values(expenseData).reduce((a, b) => a + b, 0) / 4).toLocaleString()} บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปีที่สูงสุด</span>
                            <span class="metric-value">ปี ${Object.keys(expenseData).find(key => expenseData[key] === Math.max(...Object.values(expenseData)))}</span>
                        </div>
                    </div>

                    <div class="card">
                        <h3>🎯 สัดส่วนในปี 2568</h3>
                        <div class="metric">
                            <span class="metric-label">จำนวนเงิน</span>
                            <span class="metric-value">${expenseData['2568'].toLocaleString()} บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">สัดส่วนของรวม</span>
                            <span class="metric-value" style="color: #4c63d2;">${((expenseData['2568'] / 14906254.68) * 100).toFixed(2)}%</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">อันดับ</span>
                            <span class="metric-value">${getExpenseRank(selectedExpense)}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">หมวดหมู่</span>
                            <span class="metric-value">${getExpenseCategory(selectedExpense)}</span>
                        </div>
                    </div>

                    <div class="card">
                        <h3>💡 ข้อสังเกต</h3>
                        <div class="metric">
                            <span class="metric-label">สถานะ</span>
                            <span class="metric-value" style="color: ${getExpenseStatus(selectedExpense).color};">${getExpenseStatus(selectedExpense).text}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ความผันแปร</span>
                            <span class="metric-value">${getExpenseVariability(expenseData)}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">แนวโน้ม</span>
                            <span class="metric-value">${getExpenseTrend(expenseData)}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ความสำคัญ</span>
                            <span class="metric-value">${getExpenseImportance(selectedExpense)}</span>
                        </div>
                    </div>

                    <div class="card">
                        <h3>📊 เปรียบเทียบกับรวม</h3>
                        <div class="metric">
                            <span class="metric-label">ปี 2565</span>
                            <span class="metric-value">${((expenseData['2565'] / 12624347.80) * 100).toFixed(2)}%</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2566</span>
                            <span class="metric-value">${((expenseData['2566'] / 13671117.91) * 100).toFixed(2)}%</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2567</span>
                            <span class="metric-value">${((expenseData['2567'] / 14532623.81) * 100).toFixed(2)}%</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2568</span>
                            <span class="metric-value">${((expenseData['2568'] / 14906254.68) * 100).toFixed(2)}%</span>
                        </div>
                    </div>
                `;
            }
        }

        function updatePersonnelExpensesChart(selectedExpense = 'ข้อมูลทั้งหมด') {
            if (revenueChart) {
                revenueChart.destroy();
            }
            
            const ctx = document.getElementById('revenueChart').getContext('2d');
            
            if (selectedExpense === 'ข้อมูลทั้งหมด') {
                revenueChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['2565', '2566', '2567', '2568'],
                        datasets: [
                            {
                                label: 'รวมค่าใช้จ่ายด้านบุคลากร (ล้านบาท)',
                                data: [12.62, 13.67, 14.53, 14.91],
                                backgroundColor: '#4c63d2',
                                borderColor: '#4c63d2',
                                borderWidth: 1
                            },
                            {
                                label: 'ค่าตอบแทนปฏิบัติงานนอกเวลาราชการ (ล้านบาท)',
                                data: [4.54, 4.54, 5.17, 5.50],
                                backgroundColor: '#ef4444',
                                borderColor: '#ef4444',
                                borderWidth: 1
                            },
                            {
                                label: 'ค่าจ้างพนักงานกระทรวงสาธารณสุข (ล้านบาท)',
                                data: [2.52, 1.76, 2.40, 2.67],
                                backgroundColor: '#10b981',
                                borderColor: '#10b981',
                                borderWidth: 1
                            },
                            {
                                label: 'ค่าตอบแทน ฉ.11 (ล้านบาท)',
                                data: [2.22, 1.90, 1.80, 1.86],
                                backgroundColor: '#f59e0b',
                                borderColor: '#f59e0b',
                                borderWidth: 1
                            },
                            {
                                label: 'ค่าจ้างลูกจ้างชั่วคราวรายเดือน (ล้านบาท)',
                                data: [0.44, 1.91, 1.38, 0.72],
                                backgroundColor: '#8b5cf6',
                                borderColor: '#8b5cf6',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                labels: {
                                    font: {
                                        family: 'Prompt'
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    font: {
                                        family: 'Prompt'
                                    }
                                }
                            },
                            x: {
                                ticks: {
                                    font: {
                                        family: 'Prompt'
                                    }
                                }
                            }
                        },
                        onClick: (event, elements) => {
                            if (elements.length > 0) {
                                const element = elements[0];
                                const datasetIndex = element.datasetIndex;
                                const dataIndex = element.index;
                                
                                const dataset = revenueChart.data.datasets[datasetIndex];
                                const year = revenueChart.data.labels[dataIndex];
                                const datasetLabel = dataset.label;
                                
                                const fullAmount = personnelExpensesDataMapping[datasetLabel][year];
                                
                                showDataPopup(datasetLabel, year, fullAmount);
                            }
                        }
                    }
                });
            } else {
                // Show single expense chart
                const expenseData = getPersonnelExpenseData(selectedExpense);
                const chartData = Object.keys(expenseData).map(year => expenseData[year] / 1000000); // Convert to millions
                
                revenueChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['2565', '2566', '2567', '2568'],
                        datasets: [
                            {
                                label: `${selectedExpense} (ล้านบาท)`,
                                data: chartData,
                                borderColor: '#4c63d2',
                                backgroundColor: '#4c63d2' + '20',
                                tension: 0.4,
                                fill: true,
                                pointBackgroundColor: '#4c63d2',
                                pointBorderColor: '#ffffff',
                                pointBorderWidth: 2,
                                pointRadius: 6
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                labels: {
                                    font: {
                                        family: 'Prompt'
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    font: {
                                        family: 'Prompt'
                                    }
                                }
                            },
                            x: {
                                ticks: {
                                    font: {
                                        family: 'Prompt'
                                    }
                                }
                            }
                        },
                        onClick: (event, elements) => {
                            if (elements.length > 0) {
                                const element = elements[0];
                                const dataIndex = element.index;
                                const year = revenueChart.data.labels[dataIndex];
                                const amount = `${expenseData[year].toLocaleString()} บาท`;
                                
                                showDataPopup(selectedExpense, year, amount);
                            }
                        }
                    }
                });
            }
        }

        // Helper functions for personnel expenses
        function getPersonnelExpenseData(expenseName) {
            const expenseDataMap = {
                'ค่าจ้างลูกจ้างชั่วคราวรายเดือน': { '2565': 441840, '2566': 1909810, '2567': 1384480, '2568': 720270 },
                'ค่าจ้างลูกจ้างชั่วคราวรายวัน': { '2565': 1356179.55, '2566': 1536720, '2567': 1571200, '2568': 1786640 },
                'ค่าจ้างพนักงานกระทรวงสาธารณสุข': { '2565': 2523700, '2566': 1761660, '2567': 2395480, '2568': 2668452 },
                'ค่าตอบแทนไม่ทำเวชปฏิบัติ': { '2565': 665000, '2566': 570000, '2567': 655000, '2568': 640000 },
                'เงิน พตส.': { '2565': 36000, '2566': 144661.30, '2567': 103500, '2568': 37790.66 },
                'ค่าตอบแทน ฉ.11': { '2565': 2215841, '2566': 1903671, '2567': 1801700, '2568': 1859785 },
                'ค่าตอบแทน ฉ.12': { '2565': 354400, '2566': 343200, '2567': 371600, '2568': 389100 },
                'ค่าตอบแทนปฏิบัติงานนอกเวลาราชการ': { '2565': 4541636.25, '2566': 4544211.25, '2567': 5174111.81, '2568': 5501398.14 },
                'ค่าตอบแทนเจ้าหน้าที่ปฏิบัติงานเฉพาะบ่าย, ดึก': { '2565': 296160, '2566': 440040, '2567': 569160, '2568': 469080 },
                'อื่น ฯ (ค่าชันสูตรพลิกศพ)': { '2565': 5250, '2566': 0, '2567': 1500, '2568': 7950 },
                'เงินสมทบประกันสังคมส่วนของนายจ้าง': { '2565': 129001, '2566': 239218, '2567': 255900, '2568': 214419 },
                'ค่าใช้จ่ายในการเดินทางไปราชการ': { '2565': 59340, '2566': 277926.36, '2567': 248992, '2568': 611369.88 }
            };
            
            return expenseDataMap[expenseName] || { '2565': 0, '2566': 0, '2567': 0, '2568': 0 };
        }

        function getChangePercent(current, previous) {
            if (previous === 0) return current > 0 ? '+∞%' : '0%';
            const change = ((current - previous) / previous) * 100;
            return (change >= 0 ? '+' : '') + change.toFixed(2) + '%';
        }

        function getChangeColor(current, previous) {
            if (current > previous) return '#ef4444'; // Red for increase in expenses
            if (current < previous) return '#10b981'; // Green for decrease in expenses
            return '#6b7280'; // Gray for no change
        }

        function getExpenseRank(expenseName) {
            const ranks = {
                'ค่าตอบแทนปฏิบัติงานนอกเวลาราชการ': '1',
                'ค่าจ้างพนักงานกระทรวงสาธารณสุข': '2',
                'ค่าตอบแทน ฉ.11': '3',
                'ค่าจ้างลูกจ้างชั่วคราวรายวัน': '4',
                'ค่าจ้างลูกจ้างชั่วคราวรายเดือน': '5',
                'ค่าตอบแทนไม่ทำเวชปฏิบัติ': '6',
                'ค่าใช้จ่ายในการเดินทางไปราชการ': '7',
                'ค่าตอบแทนเจ้าหน้าที่ปฏิบัติงานเฉพาะบ่าย, ดึก': '8',
                'ค่าตอบแทน ฉ.12': '9',
                'เงินสมทบประกันสังคมส่วนของนายจ้าง': '10',
                'เงิน พตส.': '11',
                'อื่น ฯ (ค่าชันสูตรพลิกศพ)': '12'
            };
            return ranks[expenseName] || 'N/A';
        }

        function getExpenseCategory(expenseName) {
            const categories = {
                'ค่าตอบแทนปฏิบัติงานนอกเวลาราชการ': 'ค่าตอบแทน',
                'ค่าจ้างพนักงานกระทรวงสาธารณสุข': 'ค่าจ้าง',
                'ค่าตอบแทน ฉ.11': 'ค่าตอบแทน',
                'ค่าจ้างลูกจ้างชั่วคราวรายวัน': 'ค่าจ้าง',
                'ค่าจ้างลูกจ้างชั่วคราวรายเดือน': 'ค่าจ้าง',
                'ค่าตอบแทนไม่ทำเวชปฏิบัติ': 'ค่าตอบแทน',
                'ค่าใช้จ่ายในการเดินทางไปราชการ': 'ค่าใช้สอย',
                'ค่าตอบแทนเจ้าหน้าที่ปฏิบัติงานเฉพาะบ่าย, ดึก': 'ค่าตอบแทน',
                'ค่าตอบแทน ฉ.12': 'ค่าตอบแทน',
                'เงินสมทบประกันสังคมส่วนของนายจ้าง': 'สวัสดิการ',
                'เงิน พตส.': 'สวัสดิการ',
                'อื่น ฯ (ค่าชันสูตรพลิกศพ)': 'ค่าใช้สอย'
            };
            return categories[expenseName] || 'อื่นๆ';
        }

        function getExpenseStatus(expenseName) {
            const statuses = {
                'ค่าตอบแทนปฏิบัติงานนอกเวลาราชการ': { text: 'เพิ่มขึ้นต่อเนื่อง', color: '#ef4444' },
                'ค่าจ้างพนักงานกระทรวงสาธารณสุข': { text: 'เพิ่มขึ้น', color: '#f59e0b' },
                'ค่าตอบแทน ฉ.11': { text: 'คงที่', color: '#10b981' },
                'ค่าจ้างลูกจ้างชั่วคราวรายวัน': { text: 'เพิ่มขึ้น', color: '#f59e0b' },
                'ค่าจ้างลูกจ้างชั่วคราวรายเดือน': { text: 'ลดลงมาก', color: '#10b981' },
                'ค่าตอบแทนไม่ทำเวชปฏิบัติ': { text: 'คงที่', color: '#6b7280' },
                'ค่าใช้จ่ายในการเดินทางไปราชการ': { text: 'เพิ่มขึ้นมาก', color: '#ef4444' },
                'ค่าตอบแทนเจ้าหน้าที่ปฏิบัติงานเฉพาะบ่าย, ดึก': { text: 'ผันแปร', color: '#f59e0b' },
                'ค่าตอบแทน ฉ.12': { text: 'เพิ่มขึ้นเล็กน้อย', color: '#f59e0b' },
                'เงินสมทบประกันสังคมส่วนของนายจ้าง': { text: 'ผันแปร', color: '#f59e0b' },
                'เงิน พตส.': { text: 'ลดลงมาก', color: '#10b981' },
                'อื่น ฯ (ค่าชันสูตรพลิกศพ)': { text: 'ผันแปรมาก', color: '#f59e0b' }
            };
            return statuses[expenseName] || { text: 'ไม่ทราบ', color: '#6b7280' };
        }

        function getExpenseVariability(expenseData) {
            const values = Object.values(expenseData);
            const max = Math.max(...values);
            const min = Math.min(...values);
            const avg = values.reduce((a, b) => a + b, 0) / values.length;
            const variance = ((max - min) / avg) * 100;
            
            if (variance < 20) return 'ต่ำ';
            if (variance < 50) return 'ปานกลาง';
            return 'สูง';
        }

        function getExpenseTrend(expenseData) {
            const values = Object.values(expenseData);
            const firstHalf = (values[0] + values[1]) / 2;
            const secondHalf = (values[2] + values[3]) / 2;
            
            if (secondHalf > firstHalf * 1.1) return 'เพิ่มขึ้น';
            if (secondHalf < firstHalf * 0.9) return 'ลดลง';
            return 'คงที่';
        }

        function getExpenseImportance(expenseName) {
            const importance = {
                'ค่าตอบแทนปฏิบัติงานนอกเวลาราชการ': 'สูงมาก',
                'ค่าจ้างพนักงานกระทรวงสาธารณสุข': 'สูง',
                'ค่าตอบแทน ฉ.11': 'สูง',
                'ค่าจ้างลูกจ้างชั่วคราวรายวัน': 'ปานกลาง',
                'ค่าจ้างลูกจ้างชั่วคราวรายเดือน': 'ปานกลาง',
                'ค่าตอบแทนไม่ทำเวชปฏิบัติ': 'ปานกลาง',
                'ค่าใช้จ่ายในการเดินทางไปราชการ': 'ต่ำ',
                'ค่าตอบแทนเจ้าหน้าที่ปฏิบัติงานเฉพาะบ่าย, ดึก': 'ปานกลาง',
                'ค่าตอบแทน ฉ.12': 'ปานกลาง',
                'เงินสมทบประกันสังคมส่วนของนายจ้าง': 'ต่ำ',
                'เงิน พตส.': 'ต่ำ',
                'อื่น ฯ (ค่าชันสูตรพลิกศพ)': 'ต่ำมาก'
            };
            return importance[expenseName] || 'ไม่ทราบ';
        }

        function showPersonnelExpensesTable() {
            // Replace existing tables with personnel expenses table
            const chartContainer = document.querySelector('.chart-container');
            chartContainer.innerHTML = `
                <h3>แนวโน้มรายจ่ายด้านบุคลากร 4 ปี</h3>
                <canvas id="revenueChart" width="400" height="200"></canvas>
            `;
            
            const dataTableContainer = document.querySelector('.data-table');
            dataTableContainer.innerHTML = `
                <h3>ตารางรายจ่ายด้านบุคลากร</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ลำดับ</th>
                            <th>รายการ</th>
                            <th>รายจ่าย ปี 65</th>
                            <th>รายจ่าย ปี 66</th>
                            <th>รายจ่าย ปี 67</th>
                            <th>รายจ่าย ปี 68</th>
                            <th>แนวโน้ม (%)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: rgba(76, 99, 210, 0.05);">
                            <td></td>
                            <td style="font-weight: 600;">รายจ่ายด้านบุคลากร (Fixed Cost)</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">1.1</td>
                            <td style="padding-left: 20px;">ค่าจ้างลูกจ้างชั่วคราวรายเดือน</td>
                            <td>441,840.00</td>
                            <td>1,909,810.00</td>
                            <td>1,384,480.00</td>
                            <td>720,270.00</td>
                            <td style="color: #ef4444;">-47.98%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">1.2</td>
                            <td style="padding-left: 20px;">ค่าจ้างลูกจ้างชั่วคราวรายวัน</td>
                            <td>1,356,179.55</td>
                            <td>1,536,720.00</td>
                            <td>1,571,200.00</td>
                            <td>1,786,640.00</td>
                            <td style="color: #10b981;">+13.72%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">1.3</td>
                            <td style="padding-left: 20px;">ค่าจ้างพนักงานกระทรวงสาธารณสุข</td>
                            <td>2,523,700.00</td>
                            <td>1,761,660.00</td>
                            <td>2,395,480.00</td>
                            <td>2,668,452.00</td>
                            <td style="color: #10b981;">+11.39%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">1.4</td>
                            <td style="padding-left: 20px;">ค่าตอบแทนไม่ทำเวชปฏิบัติ</td>
                            <td>665,000.00</td>
                            <td>570,000.00</td>
                            <td>655,000.00</td>
                            <td>640,000.00</td>
                            <td style="color: #ef4444;">-2.29%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">1.5</td>
                            <td style="padding-left: 20px;">เงิน พตส.</td>
                            <td>36,000.00</td>
                            <td>144,661.30</td>
                            <td>103,500.00</td>
                            <td>37,790.66</td>
                            <td style="color: #ef4444;">-63.48%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">1.6</td>
                            <td style="padding-left: 20px;">ค่าตอบแทน ฉ.11</td>
                            <td>2,215,841.00</td>
                            <td>1,903,671.00</td>
                            <td>1,801,700.00</td>
                            <td>1,859,785.00</td>
                            <td style="color: #10b981;">+3.22%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">1.7</td>
                            <td style="padding-left: 20px;">ค่าตอบแทน ฉ.12</td>
                            <td>354,400.00</td>
                            <td>343,200.00</td>
                            <td>371,600.00</td>
                            <td>389,100.00</td>
                            <td style="color: #10b981;">+4.71%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">1.8</td>
                            <td style="padding-left: 20px;">ค่าตอบแทนปฏิบัติงานนอกเวลาราชการ</td>
                            <td>4,541,636.25</td>
                            <td>4,544,211.25</td>
                            <td>5,174,111.81</td>
                            <td>5,501,398.14</td>
                            <td style="color: #10b981;">+6.32%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">1.9</td>
                            <td style="padding-left: 20px;">ค่าตอบแทนเจ้าหน้าที่ปฏิบัติงานเฉพาะบ่าย, ดึก</td>
                            <td>296,160.00</td>
                            <td>440,040.00</td>
                            <td>569,160.00</td>
                            <td>469,080.00</td>
                            <td style="color: #ef4444;">-17.58%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">1.10</td>
                            <td style="padding-left: 20px;">อื่น ฯ (ค่าชันสูตรพลิกศพ)</td>
                            <td>5,250.00</td>
                            <td>0.00</td>
                            <td>1,500.00</td>
                            <td>7,950.00</td>
                            <td style="color: #10b981;">+430.00%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">2.1</td>
                            <td style="padding-left: 20px;">เงินสมทบประกันสังคมส่วนของนายจ้าง</td>
                            <td>129,001.00</td>
                            <td>239,218.00</td>
                            <td>255,900.00</td>
                            <td>214,419.00</td>
                            <td style="color: #ef4444;">-16.21%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">2.2</td>
                            <td style="padding-left: 20px;">ค่าใช้จ่ายในการเดินทางไปราชการ</td>
                            <td>59,340.00</td>
                            <td>277,926.36</td>
                            <td>248,992.00</td>
                            <td>611,369.88</td>
                            <td style="color: #10b981;">+145.50%</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.15); font-weight: 700; color: #4c63d2;">
                            <td></td>
                            <td>รวมค่าใช้จ่ายด้านบุคลากร</td>
                            <td>12,624,347.80</td>
                            <td>13,671,117.91</td>
                            <td>14,532,623.81</td>
                            <td>14,906,254.68</td>
                            <td style="color: #ef4444;">+2.57%</td>
                        </tr>
                    </tbody>
                </table>
            `;

            // Add the detailed personnel expenses table after the main table
            const mainContent = document.querySelector('.main-content');
            const existingDetailedTable = document.getElementById('detailed-personnel-expenses-table');
            if (existingDetailedTable) {
                existingDetailedTable.remove();
            }

            const detailedTable = document.createElement('div');
            detailedTable.id = 'detailed-personnel-expenses-table';
            detailedTable.className = 'data-table';
            detailedTable.style.marginTop = '20px';
            detailedTable.innerHTML = `
                <h3>ตารางรายจ่ายด้านบุคลากร - รายละเอียดแนวโน้ม 4 ปี</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ลำดับ</th>
                            <th>รายการ</th>
                            <th>รายจ่าย ปี 65</th>
                            <th>รายจ่าย ปี 66</th>
                            <th>รายจ่าย ปี 67</th>
                            <th>รายจ่าย ปี 68</th>
                            <th>แนวโน้ม (%)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: rgba(76, 99, 210, 0.05);">
                            <td></td>
                            <td style="font-weight: 600; color: #4c63d2;">รายจ่ายด้านบุคลากร (Fixed Cost)</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td rowspan="10" style="text-align: center; font-weight: 600; color: #4c63d2; vertical-align: middle; background: rgba(76, 99, 210, 0.1);">1</td>
                            <td style="padding-left: 20px;">ค่าจ้างลูกจ้างชั่วคราวรายเดือน</td>
                            <td>441,840.00</td>
                            <td>1,909,810.00</td>
                            <td>1,384,480.00</td>
                            <td>720,270.00</td>
                            <td style="color: #ef4444; font-weight: 600;">-47.98%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">ค่าจ้างลูกจ้างชั่วคราวรายวัน</td>
                            <td>1,356,179.55</td>
                            <td>1,536,720.00</td>
                            <td>1,571,200.00</td>
                            <td>1,786,640.00</td>
                            <td style="color: #10b981; font-weight: 600;">+13.72%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">ค่าจ้างพนักงานกระทรวงสาธารณสุข</td>
                            <td>2,523,700.00</td>
                            <td>1,761,660.00</td>
                            <td>2,395,480.00</td>
                            <td>2,668,452.00</td>
                            <td style="color: #10b981; font-weight: 600;">+11.39%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">ค่าตอบแทนไม่ทำเวชปฏิบัติ</td>
                            <td>665,000.00</td>
                            <td>570,000.00</td>
                            <td>655,000.00</td>
                            <td>640,000.00</td>
                            <td style="color: #ef4444; font-weight: 600;">-2.29%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">เงิน พตส.</td>
                            <td>36,000.00</td>
                            <td>144,661.30</td>
                            <td>103,500.00</td>
                            <td>37,790.66</td>
                            <td style="color: #ef4444; font-weight: 600;">-63.48%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">ค่าตอบแทน ฉ.11</td>
                            <td>2,215,841.00</td>
                            <td>1,903,671.00</td>
                            <td>1,801,700.00</td>
                            <td>1,859,785.00</td>
                            <td style="color: #10b981; font-weight: 600;">+3.22%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">ค่าตอบแทน ฉ.12</td>
                            <td>354,400.00</td>
                            <td>343,200.00</td>
                            <td>371,600.00</td>
                            <td>389,100.00</td>
                            <td style="color: #10b981; font-weight: 600;">+4.71%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">ค่าตอบแทนปฏิบัติงานนอกเวลาราชการ</td>
                            <td>4,541,636.25</td>
                            <td>4,544,211.25</td>
                            <td>5,174,111.81</td>
                            <td>5,501,398.14</td>
                            <td style="color: #10b981; font-weight: 600;">+6.32%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">ค่าตอบแทนเจ้าหน้าที่ปฏิบัติงานเฉพาะบ่าย, ดึก</td>
                            <td>296,160.00</td>
                            <td>440,040.00</td>
                            <td>569,160.00</td>
                            <td>469,080.00</td>
                            <td style="color: #ef4444; font-weight: 600;">-17.58%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">อื่น ฯ (ค่าชันสูตรพลิกศพ)</td>
                            <td>5,250.00</td>
                            <td>0.00</td>
                            <td>1,500.00</td>
                            <td>7,950.00</td>
                            <td style="color: #10b981; font-weight: 600;">+430.00%</td>
                        </tr>
                        <tr>
                            <td rowspan="2" style="text-align: center; font-weight: 600; color: #4c63d2; vertical-align: middle; background: rgba(76, 99, 210, 0.1);">2</td>
                            <td style="padding-left: 20px;">เงินสมทบประกันสังคมส่วนของนายจ้าง</td>
                            <td>129,001.00</td>
                            <td>239,218.00</td>
                            <td>255,900.00</td>
                            <td>214,419.00</td>
                            <td style="color: #ef4444; font-weight: 600;">-16.21%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">ค่าใช้จ่ายในการเดินทางไปราชการ</td>
                            <td>59,340.00</td>
                            <td>277,926.36</td>
                            <td>248,992.00</td>
                            <td>611,369.88</td>
                            <td style="color: #10b981; font-weight: 600;">+145.50%</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.15); font-weight: 700; color: #4c63d2;">
                            <td></td>
                            <td>รวมค่าใช้จ่ายด้านบุคลากร</td>
                            <td>12,624,347.80</td>
                            <td>13,671,117.91</td>
                            <td>14,532,623.81</td>
                            <td>14,906,254.68</td>
                            <td style="color: #ef4444;">+2.57%</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.05);">
                            <td colspan="7" style="font-weight: 600; color: #4c63d2; text-align: center;">สรุปแนวโน้มรายจ่ายหลัก</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #ef4444;">สูงสุด</td>
                            <td style="padding-left: 20px;">ค่าตอบแทนปฏิบัติงานนอกเวลาราชการ</td>
                            <td colspan="4" style="text-align: center; color: #4c63d2; font-weight: 600;">รายจ่ายสูงสุด 5.5 ล้านบาท (ปี 68)</td>
                            <td style="color: #10b981; font-weight: 600;">+6.32%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #10b981;">เติบโต</td>
                            <td style="padding-left: 20px;">ค่าใช้จ่ายในการเดินทางไปราชการ</td>
                            <td colspan="4" style="text-align: center; color: #4c63d2; font-weight: 600;">เติบโตสูงสุด 145.50%</td>
                            <td style="color: #10b981; font-weight: 600;">+145.50%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #ef4444;">ลดลง</td>
                            <td style="padding-left: 20px;">เงิน พตส.</td>
                            <td colspan="4" style="text-align: center; color: #4c63d2; font-weight: 600;">ลดลงสูงสุด -63.48%</td>
                            <td style="color: #ef4444; font-weight: 600;">-63.48%</td>
                        </tr>
                    </tbody>
                </table>
            `;

            // Insert the detailed table after the first data table
            const firstDataTable = document.querySelector('.data-table');
            firstDataTable.parentNode.insertBefore(detailedTable, firstDataTable.nextSibling);

            // Hide other tables
            const otherTables = document.querySelectorAll('.data-table:not(:first-of-type):not(#detailed-personnel-expenses-table)');
            otherTables.forEach(table => table.style.display = 'none');
            
            // Re-initialize chart
            updatePersonnelExpensesChart();
        }

        function showOperatingIncomeTable() {
            // Replace existing tables with operating income table
            const chartContainer = document.querySelector('.chart-container');
            chartContainer.innerHTML = `
                <h3>แนวโน้มรายได้จากการดำเนินการ 4 ปี</h3>
                <canvas id="revenueChart" width="400" height="200"></canvas>
            `;
            
            const dataTableContainer = document.querySelector('.data-table');
            dataTableContainer.innerHTML = `
                <h3>ตารางรายได้จากการดำเนินการ</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ลำดับ</th>
                            <th>รายการ</th>
                            <th>รายรับ ปี 65</th>
                            <th>รายรับ ปี 66</th>
                            <th>รายรับ ปี 67</th>
                            <th>รายรับ ปี 68</th>
                            <th>สรุปผลประกอบการกองทุนเทียบกันปีก่อน</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: rgba(76, 99, 210, 0.15); font-weight: 700; color: #4c63d2;">
                            <td></td>
                            <td>รวมรายได้จากการดำเนินการ</td>
                            <td>31,907,620.28</td>
                            <td>30,495,051.60</td>
                            <td>24,337,426.36</td>
                            <td>17,508,030.81</td>
                            <td style="color: #ef4444;">-28.06%</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.05);">
                            <td></td>
                            <td style="font-weight: 600;">รายได้สนับสนุน</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">สนับสนุน</td>
                            <td style="padding-left: 20px;">เงินรับบริจาค</td>
                            <td>535,010.00</td>
                            <td>1,423,500.00</td>
                            <td>632,001.00</td>
                            <td>178,875.00</td>
                            <td style="color: #ef4444;">-71.69%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">สนับสนุน</td>
                            <td style="padding-left: 20px;">เงินค่าเสื่อม/งบลงทุน</td>
                            <td>2,225,672.61</td>
                            <td>1,573,444.29</td>
                            <td>2,372,730.03</td>
                            <td>2,720,600.00</td>
                            <td style="color: #10b981;">+14.66%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">สนับสนุน</td>
                            <td style="padding-left: 20px;">CF (UC IP + UC OP + UC PP)</td>
                            <td>1,050,027.98</td>
                            <td>4,407,450.00</td>
                            <td>2,657,128.00</td>
                            <td>500,000.00</td>
                            <td style="color: #ef4444;">-81.18%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">สนับสนุน</td>
                            <td style="padding-left: 20px;">เงินสนับสนุนจากหน่วยงานอื่น</td>
                            <td>78,420.00</td>
                            <td>2,055,000.00</td>
                            <td>1,150,000.00</td>
                            <td>2,934,000.00</td>
                            <td style="color: #10b981;">+155.13%</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.1); font-weight: 600;">
                            <td></td>
                            <td>รวมรายได้สนับสนุน (CF + สนับสนุนจากหน่วยงานอื่น)</td>
                            <td>1,128,447.98</td>
                            <td>6,462,450.00</td>
                            <td>3,807,128.00</td>
                            <td>3,434,000.00</td>
                            <td style="color: #ef4444;">-9.80%</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.15); font-weight: 700; color: #4c63d2;">
                            <td></td>
                            <td>รายรับจากการดำเนินการ + CF</td>
                            <td>33,036,068.26</td>
                            <td>36,957,501.60</td>
                            <td>28,144,554.36</td>
                            <td>20,942,030.81</td>
                            <td style="color: #ef4444;">-25.59%</td>
                        </tr>
                    </tbody>
                </table>
            `;

            // Add the detailed operating income table after the main table
            const mainContent = document.querySelector('.main-content');
            const existingDetailedTable = document.getElementById('detailed-operating-income-table');
            if (existingDetailedTable) {
                existingDetailedTable.remove();
            }

            const detailedTable = document.createElement('div');
            detailedTable.id = 'detailed-operating-income-table';
            detailedTable.className = 'data-table';
            detailedTable.style.marginTop = '20px';
            detailedTable.innerHTML = `
                <h3>ตารางรายได้จากการดำเนินการ - รายละเอียดแนวโน้ม 4 ปี</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ประเภทรายได้</th>
                            <th>รายรับ ปี 65</th>
                            <th>รายรับ ปี 66</th>
                            <th>รายรับ ปี 67</th>
                            <th>รายรับ ปี 68</th>
                            <th>แนวโน้ม</th>
                            <th>หมายเหตุ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: rgba(76, 99, 210, 0.15); font-weight: 700; color: #4c63d2;">
                            <td>รวมรายได้จากการดำเนินการ</td>
                            <td>31,907,620.28</td>
                            <td>30,495,051.60</td>
                            <td>24,337,426.36</td>
                            <td>17,508,030.81</td>
                            <td style="color: #ef4444;">↓ -28.06%</td>
                            <td>รายได้หลัก</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.05);">
                            <td colspan="7" style="font-weight: 600; color: #4c63d2; text-align: center;">รายได้สนับสนุน</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">เงินรับบริจาค</td>
                            <td>535,010.00</td>
                            <td>1,423,500.00</td>
                            <td>632,001.00</td>
                            <td>178,875.00</td>
                            <td style="color: #ef4444;">↓ -71.69%</td>
                            <td>บริจาคจากประชาชน</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">เงินค่าเสื่อม/งบลงทุน</td>
                            <td>2,225,672.61</td>
                            <td>1,573,444.29</td>
                            <td>2,372,730.03</td>
                            <td>2,720,600.00</td>
                            <td style="color: #10b981;">↑ +14.66%</td>
                            <td>งบลงทุนจากรัฐ</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">CF (UC IP + UC OP + UC PP)</td>
                            <td>1,050,027.98</td>
                            <td>4,407,450.00</td>
                            <td>2,657,128.00</td>
                            <td>500,000.00</td>
                            <td style="color: #ef4444;">↓ -81.18%</td>
                            <td>เงินทุนหมุนเวียน UC</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">เงินสนับสนุนจากหน่วยงานอื่น</td>
                            <td>78,420.00</td>
                            <td>2,055,000.00</td>
                            <td>1,150,000.00</td>
                            <td>2,934,000.00</td>
                            <td style="color: #10b981;">↑ +155.13%</td>
                            <td>รพ.พหลฯ, รพ.มะการักษ์, รพ.ทองผาภูมิ</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.1); font-weight: 600;">
                            <td>รวมรายได้สนับสนุน (CF + สนับสนุนจากหน่วยงานอื่น)</td>
                            <td>1,128,447.98</td>
                            <td>6,462,450.00</td>
                            <td>3,807,128.00</td>
                            <td>3,434,000.00</td>
                            <td style="color: #ef4444;">↓ -9.80%</td>
                            <td>-</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.15); font-weight: 700; color: #4c63d2;">
                            <td>รายรับจากการดำเนินการ + CF</td>
                            <td>33,036,068.26</td>
                            <td>36,957,501.60</td>
                            <td>28,144,554.36</td>
                            <td>20,942,030.81</td>
                            <td style="color: #ef4444;">↓ -25.59%</td>
                            <td>รวมทั้งหมด</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.05);">
                            <td colspan="7" style="font-weight: 600; color: #4c63d2; text-align: center;">รายละเอียดเงินสนับสนุนจากหน่วยงานอื่น</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 40px; font-size: 14px;">ปี 2566: รพ.พหลฯ สนับสนุน</td>
                            <td>-</td>
                            <td>2,000,000</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                            <td>สนับสนุนตอนปี 66</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 40px; font-size: 14px;">ปี 2567: รับเงินสนับสนุนจากรพ.มะการักษ์</td>
                            <td>-</td>
                            <td>-</td>
                            <td>1,000,000</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 40px; font-size: 14px;">ปี 2567: รับเงินสนับสนุนจากวิงการกุศล</td>
                            <td>-</td>
                            <td>-</td>
                            <td>150,000</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 40px; font-size: 14px;">ปี 2568: รับเงินสนับสนุนรพ.ไทรโยค</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                            <td>500,000</td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 40px; font-size: 14px;">ปี 2568: รับเงินสนับสนุนรพ.เลาขวัญ</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                            <td>500,000</td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 40px; font-size: 14px;">ปี 2568: รับเงินสนับสนุนรพ.ทองผาภูมิ</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                            <td>1,934,000</td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    </tbody>
                </table>
            `;

            // Insert the detailed table after the first data table
            const firstDataTable = document.querySelector('.data-table');
            firstDataTable.parentNode.insertBefore(detailedTable, firstDataTable.nextSibling);
            
            // Hide other tables
            const otherTables = document.querySelectorAll('.data-table:not(:first-of-type):not(#detailed-operating-income-table)');
            otherTables.forEach(table => table.style.display = 'none');
            
            // Re-initialize chart
            updateOperatingIncomeChart();
        }

        function showOtherIncomeTable() {
            // Replace existing tables with other income table
            const chartContainer = document.querySelector('.chart-container');
            chartContainer.innerHTML = `
                <h3>แนวโน้มรายได้อื่นๆ 4 ปี</h3>
                <canvas id="revenueChart" width="400" height="200"></canvas>
            `;
            
            const dataTableContainer = document.querySelector('.data-table');
            dataTableContainer.innerHTML = `
                <h3>ตารางรายได้อื่นๆ</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ลำดับ</th>
                            <th>รายการ</th>
                            <th>รายรับ ปี 65</th>
                            <th>รายรับ ปี 66</th>
                            <th>รายรับ ปี 67</th>
                            <th>รายรับ ปี 68</th>
                            <th>สรุปผลประกอบการกองทุนเทียบกันปีก่อน</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: rgba(76, 99, 210, 0.05);">
                            <td></td>
                            <td style="font-weight: 600;">รายได้อื่นๆ</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">อื่นๆ</td>
                            <td style="padding-left: 20px;">รายได้ค่าบริการรักษาพยาบาลโรคติดเชื้อไวรัสโคโรน่า (สปสช.)</td>
                            <td>10,939,264.62</td>
                            <td>3,463,394.43</td>
                            <td>-</td>
                            <td>-</td>
                            <td style="color: #ef4444;">-68.34%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">อื่นๆ</td>
                            <td style="padding-left: 20px;">รายได้ค่าบริการรักษาพยาบาลโรคติดเชื้อไวรัสโคโรน่า (ประกันสังคม)</td>
                            <td>589,119.60</td>
                            <td>905,676.00</td>
                            <td>-</td>
                            <td>-</td>
                            <td style="color: #10b981;">+53.73%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">อื่นๆ</td>
                            <td style="padding-left: 20px;">รายรับเงินกองทุนบุคคลที่มีปัญหาสถานะและสิทธิ (OPจากกระทรวง)</td>
                            <td>596,607.26</td>
                            <td>307,672.72</td>
                            <td>66,446.04</td>
                            <td>536,071.34</td>
                            <td style="color: #10b981;">+706.78%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">อื่นๆ</td>
                            <td style="padding-left: 20px;">รายรับชำระเงินเอง</td>
                            <td>1,411,446.00</td>
                            <td>1,466,069.50</td>
                            <td>1,630,536.75</td>
                            <td>1,566,850.25</td>
                            <td style="color: #ef4444;">-3.91%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">อื่นๆ</td>
                            <td style="padding-left: 20px;">รายรับ พรบ.รถ</td>
                            <td>60,949.00</td>
                            <td>225,348.00</td>
                            <td>259,003.00</td>
                            <td>129,792.00</td>
                            <td style="color: #ef4444;">-49.89%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">อื่นๆ</td>
                            <td style="padding-left: 20px;">รายรับค่ารักษาพยาบาลอื่นๆ : ตรวจสุขภาพ+ต่างด้าว +อุดหนุนIp</td>
                            <td>1,108,073.92</td>
                            <td>1,084,676.49</td>
                            <td>1,676,757.70</td>
                            <td>1,718,537.01</td>
                            <td style="color: #10b981;">+2.49%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">อื่นๆ</td>
                            <td style="padding-left: 20px;">ดอกเบี้ย</td>
                            <td>40,444.06</td>
                            <td>50,315.87</td>
                            <td>74,637.16</td>
                            <td>47,456.73</td>
                            <td style="color: #ef4444;">-36.42%</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; font-weight: 600; color: #4c63d2;">อื่นๆ</td>
                            <td style="padding-left: 20px;">กองทุนหลักประกันสุขภาพตำบล</td>
                            <td>43,500.00</td>
                            <td>126,612.00</td>
                            <td>93,975.00</td>
                            <td>129,340.00</td>
                            <td style="color: #10b981;">+37.65%</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.15); font-weight: 700; color: #4c63d2;">
                            <td></td>
                            <td>รวมรายได้อื่นๆ</td>
                            <td>14,789,404.46</td>
                            <td>7,629,765.01</td>
                            <td>3,801,355.65</td>
                            <td>4,128,047.33</td>
                            <td style="color: #10b981;">+8.59%</td>
                        </tr>
                    </tbody>
                </table>
            `;

            // Add the detailed other income table after the main table
            const mainContent = document.querySelector('.main-content');
            const existingDetailedTable = document.getElementById('detailed-other-income-table');
            if (existingDetailedTable) {
                existingDetailedTable.remove();
            }

            const detailedTable = document.createElement('div');
            detailedTable.id = 'detailed-other-income-table';
            detailedTable.className = 'data-table';
            detailedTable.style.marginTop = '20px';
            detailedTable.innerHTML = `
                <h3>ตารางรายได้อื่นๆ - รายละเอียดแนวโน้ม 4 ปี</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ประเภทรายได้</th>
                            <th>รายรับ ปี 65</th>
                            <th>รายรับ ปี 66</th>
                            <th>รายรับ ปี 67</th>
                            <th>รายรับ ปี 68</th>
                            <th>แนวโน้ม</th>
                            <th>หมายเหตุ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: rgba(76, 99, 210, 0.05);">
                            <td colspan="7" style="font-weight: 600; color: #4c63d2; text-align: center;">รายได้ COVID-19</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">รายได้ค่าบริการรักษาพยาบาลโรคติดเชื้อไวรัสโคโรน่า (สปสช.)</td>
                            <td>10,939,264.62</td>
                            <td>3,463,394.43</td>
                            <td>-</td>
                            <td>-</td>
                            <td style="color: #ef4444;">↓ -68.34%</td>
                            <td>สิ้นสุดโครงการ</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">รายได้ค่าบริการรักษาพยาบาลโรคติดเชื้อไวรัสโคโรน่า (ประกันสังคม)</td>
                            <td>589,119.60</td>
                            <td>905,676.00</td>
                            <td>-</td>
                            <td>-</td>
                            <td style="color: #10b981;">↑ +53.73%</td>
                            <td>สิ้นสุดโครงการ</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.1); font-weight: 600;">
                            <td>รวมรายได้ COVID-19</td>
                            <td>11,528,384.22</td>
                            <td>4,369,070.43</td>
                            <td>0.00</td>
                            <td>0.00</td>
                            <td style="color: #ef4444;">↓ -62.11%</td>
                            <td>-</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.05);">
                            <td colspan="7" style="font-weight: 600; color: #4c63d2; text-align: center;">รายรับชำระเงินเอง</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">รายรับชำระเงินเอง</td>
                            <td>1,411,446.00</td>
                            <td>1,466,069.50</td>
                            <td>1,630,536.75</td>
                            <td>1,566,850.25</td>
                            <td style="color: #ef4444;">↓ -3.91%</td>
                            <td>ผู้ป่วยจ่ายเอง</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.05);">
                            <td colspan="7" style="font-weight: 600; color: #4c63d2; text-align: center;">รายรับค่ารักษาพยาบาลอื่นๆ</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">รายรับเงินกองทุนบุคคลที่มีปัญหาสถานะและสิทธิ (OPจากกระทรวง)</td>
                            <td>596,607.26</td>
                            <td>307,672.72</td>
                            <td>66,446.04</td>
                            <td>536,071.34</td>
                            <td style="color: #10b981;">↑ +706.78%</td>
                            <td>กองทุนพิเศษ</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">รายรับ พรบ.รถ</td>
                            <td>60,949.00</td>
                            <td>225,348.00</td>
                            <td>259,003.00</td>
                            <td>129,792.00</td>
                            <td style="color: #ef4444;">↓ -49.89%</td>
                            <td>อุบัติเหตุจราจร</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">รายรับค่ารักษาพยาบาลอื่นๆ : ตรวจสุขภาพ+ต่างด้าว +อุดหนุนIp</td>
                            <td>1,108,073.92</td>
                            <td>1,084,676.49</td>
                            <td>1,676,757.70</td>
                            <td>1,718,537.01</td>
                            <td style="color: #10b981;">↑ +2.49%</td>
                            <td>บริการหลากหลาย</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.1); font-weight: 600;">
                            <td>รวมรายรับค่ารักษาพยาบาลอื่นๆ</td>
                            <td>1,765,630.18</td>
                            <td>1,617,697.21</td>
                            <td>2,002,206.74</td>
                            <td>2,384,400.35</td>
                            <td style="color: #10b981;">↑ +19.08%</td>
                            <td>-</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.05);">
                            <td colspan="7" style="font-weight: 600; color: #4c63d2; text-align: center;">รายรับอื่นๆ</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">ดอกเบี้ย</td>
                            <td>40,444.06</td>
                            <td>50,315.87</td>
                            <td>74,637.16</td>
                            <td>47,456.73</td>
                            <td style="color: #ef4444;">↓ -36.42%</td>
                            <td>เงินฝากธนาคาร</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">กองทุนหลักประกันสุขภาพตำบล</td>
                            <td>43,500.00</td>
                            <td>126,612.00</td>
                            <td>93,975.00</td>
                            <td>129,340.00</td>
                            <td style="color: #10b981;">↑ +37.65%</td>
                            <td>กองทุนตำบล</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.1); font-weight: 600;">
                            <td>รวมรายรับอื่นๆ</td>
                            <td>83,944.06</td>
                            <td>176,927.87</td>
                            <td>168,612.16</td>
                            <td>176,796.73</td>
                            <td style="color: #10b981;">↑ +4.85%</td>
                            <td>-</td>
                        </tr>
                        <tr style="background: rgba(76, 99, 210, 0.15); font-weight: 700; color: #4c63d2;">
                            <td>รวมรายได้อื่นๆ ทั้งหมด</td>
                            <td>14,789,404.46</td>
                            <td>7,629,765.01</td>
                            <td>3,801,355.65</td>
                            <td>4,128,047.33</td>
                            <td style="color: #10b981;">↑ +8.59%</td>
                            <td>-</td>
                        </tr>
                    </tbody>
                </table>
            `;

            // Insert the detailed table after the first data table
            const firstDataTable = document.querySelector('.data-table');
            firstDataTable.parentNode.insertBefore(detailedTable, firstDataTable.nextSibling);
            
            // Hide other tables
            const otherTables = document.querySelectorAll('.data-table:not(:first-of-type):not(#detailed-other-income-table)');
            otherTables.forEach(table => table.style.display = 'none');
            
            // Re-initialize chart
            updateOtherIncomeChart();
        }

        function updateDetailTables(year) {
            if (year === 'all') {
                // Show data for latest year (2568) when "all" is selected
                updateReceivablesTable('2568');
                updateDebtTable('2568');
            } else {
                // Show data for selected year
                updateReceivablesTable(year);
                updateDebtTable(year);
            }
        }

        function updateReceivablesTable(year) {
            const data = yearlyData[year];
            if (!data || !data.receivables_detail) return;

            const receivablesTableContainer = document.querySelector('.data-table:nth-of-type(3)');
            if (!receivablesTableContainer) return;

            const totalReceivables = data.receivables;
            
            receivablesTableContainer.innerHTML = `
                <h3>รายละเอียดลูกหนี้แยกตามสิทธิ (ปี ${year})</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ประเภทลูกหนี้</th>
                            <th>จำนวนเงิน (บาท)</th>
                            <th>สัดส่วน (%)</th>
                            <th>หมายเหตุ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${Object.entries(data.receivables_detail).map(([type, info]) => `
                            <tr>
                                <td>${type}</td>
                                <td>${info.amount.toLocaleString('th-TH', { minimumFractionDigits: 2 })}</td>
                                <td style="color: #4c63d2; font-weight: 600;">${info.percent.toFixed(2)}%</td>
                                <td>${type.includes('นอกสังกัด') ? 'นอกต้นสังกัด' : '-'}</td>
                            </tr>
                        `).join('')}
                        <tr style="background: rgba(76, 99, 210, 0.1); font-weight: 600;">
                            <td>รวมลูกหนี้ทั้งหมด</td>
                            <td>${totalReceivables.toLocaleString('th-TH', { minimumFractionDigits: 2 })}</td>
                            <td style="color: #4c63d2;">100.00%</td>
                            <td>-</td>
                        </tr>
                    </tbody>
                </table>
            `;
        }

        function updateDebtTable(year) {
            const data = yearlyData[year];
            if (!data || !data.debt_detail) return;

            const debtTableContainer = document.querySelector('.data-table:nth-of-type(4)');
            if (!debtTableContainer) return;

            const totalDebt = data.debt;
            
            debtTableContainer.innerHTML = `
                <h3>รายละเอียดเจ้าหนี้สะสม (ปี ${year})</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ประเภทเจ้าหนี้</th>
                            <th>จำนวนเงิน (บาท)</th>
                            <th>สัดส่วน (%)</th>
                            <th>หมวดหมู่</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${Object.entries(data.debt_detail).map(([type, info]) => `
                            <tr>
                                <td>${type}</td>
                                <td>${info.amount.toLocaleString('th-TH', { minimumFractionDigits: 2 })}</td>
                                <td style="color: #4c63d2; font-weight: 600;">${info.percent.toFixed(2)}%</td>
                                <td>${getDebtCategory(type)}</td>
                            </tr>
                        `).join('')}
                        <tr style="background: rgba(76, 99, 210, 0.1); font-weight: 600;">
                            <td>รวมเจ้าหนี้ทั้งหมด</td>
                            <td>${totalDebt.toLocaleString('th-TH', { minimumFractionDigits: 2 })}</td>
                            <td style="color: #4c63d2;">100.00%</td>
                            <td>-</td>
                        </tr>
                    </tbody>
                </table>
            `;
        }

        function getDebtCategory(type) {
            const categories = {
                'ค่าตอบแทน': 'ค่าตอบแทน',
                'ยา': 'ยา',
                'ค่ารักษาตามจ่ายในจังหวัดสธ.': 'นค 1',
                'วัสดุวิทยาศาสตร์': 'lab + วัสดุการแพทย์',
                'วัสดุการแพทย์': 'lab + วัสดุการแพทย์',
                'เงินมัดจำประกันสัญญา': 'เงินรับฝากทั่วไป',
                'ภาษีหัก ณ ที่จ่าย': 'เงินรับฝากทั่วไป'
            };
            return categories[type] || 'เจ้าหนี้อื่น';
        }

        function updateTableData(year, department, rights) {
            // ตารางสรุปข้อมูลทางการเงินจะแสดงข้อมูลครบทุกปีเสมอ
            // ไม่เปลี่ยนแปลงตามการเลือกปีในฟิลเตอร์
            // ข้อมูลในตารางนี้เป็นข้อมูลหลักของโรงพยาบาลที่ต้องแสดงครบถ้วน
        }

        function updateMetrics(year) {
            const metricsGrid = document.getElementById('metrics-grid');
            
            if (year === 'all') {
                // Show all years data in comparison format
                metricsGrid.innerHTML = `
                    <div class="card">
                        <h3>เงินบำรุงคงเหลือ</h3>
                        <div class="metric">
                            <span class="metric-label">ปี 2565</span>
                            <span class="metric-value">9,866,449.65 บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2566</span>
                            <span class="metric-value">12,128,216.38 บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2567</span>
                            <span class="metric-value">11,202,559.81 บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2568</span>
                            <span class="metric-value">5,621,160.91 บาท</span>
                        </div>
                    </div>

                    <div class="card">
                        <h3>ลูกหนี้สะสม (ค่ารักษาพยาบาล)</h3>
                        <div class="metric">
                            <span class="metric-label">ปี 2565</span>
                            <span class="metric-value">1,883,518.87 บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2566</span>
                            <span class="metric-value">4,335,839.68 บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2567</span>
                            <span class="metric-value">10,500,593.50 บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2568</span>
                            <span class="metric-value">10,759,203.62 บาท</span>
                        </div>
                    </div>

                    <div class="card">
                        <h3>ภาระหนี้สิน</h3>
                        <div class="metric">
                            <span class="metric-label">ปี 2565</span>
                            <span class="metric-value">4,148,801.36 บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2566</span>
                            <span class="metric-value">5,046,204.04 บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2567</span>
                            <span class="metric-value">4,747,463.01 บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2568</span>
                            <span class="metric-value">6,199,498.52 บาท</span>
                        </div>
                    </div>

                    <div class="card">
                        <h3>ผลการดำเนินงาน (NET INCOME)</h3>
                        <div class="metric">
                            <span class="metric-label">ปี 2565</span>
                            <span class="metric-value" style="color: #ef4444;">-1,334,337.12 บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2566</span>
                            <span class="metric-value" style="color: #ef4444;">-568,838.75 บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2567</span>
                            <span class="metric-value" style="color: #10b981;">3,654,100.98 บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2568</span>
                            <span class="metric-value" style="color: #ef4444;">-1,313,807.82 บาท</span>
                        </div>
                    </div>

                    <div class="card">
                        <h3>อัตราส่วนทางการเงิน (Current Ratio)</h3>
                        <div class="metric">
                            <span class="metric-label">ปี 2565</span>
                            <span class="metric-value">3.14</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2566</span>
                            <span class="metric-value">3.50</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2567</span>
                            <span class="metric-value">4.84</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2568</span>
                            <span class="metric-value">2.79</span>
                        </div>
                    </div>

                    <div class="card">
                        <h3>Working Capital</h3>
                        <div class="metric">
                            <span class="metric-label">ปี 2565</span>
                            <span class="metric-value">8,878,634.38 บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2566</span>
                            <span class="metric-value">12,614,806.17 บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2567</span>
                            <span class="metric-value">18,212,923.60 บาท</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ปี 2568</span>
                            <span class="metric-value">11,123,611.54 บาท</span>
                        </div>
                    </div>
                `;
            } else {
                // Show single year data
                const data = yearlyData[year];
                
                if (!data) return;
                
                metricsGrid.innerHTML = `
                    <div class="card">
                        <h3>เงินบำรุงคงเหลือ</h3>
                        <div class="metric">
                            <span class="metric-label">ปี ${year}</span>
                            <span class="metric-value">${data.maintenance_fund.toLocaleString()} บาท</span>
                        </div>
                    </div>

                    <div class="card">
                        <h3>ลูกหนี้สะสม (ค่ารักษาพยาบาล)</h3>
                        <div class="metric">
                            <span class="metric-label">ปี ${year}</span>
                            <span class="metric-value">${data.receivables.toLocaleString()} บาท</span>
                        </div>
                    </div>

                    <div class="card">
                        <h3>ภาระหนี้สิน</h3>
                        <div class="metric">
                            <span class="metric-label">ปี ${year}</span>
                            <span class="metric-value">${data.debt.toLocaleString()} บาท</span>
                        </div>
                    </div>

                    <div class="card">
                        <h3>ผลการดำเนินงาน (NET INCOME)</h3>
                        <div class="metric">
                            <span class="metric-label">ปี ${year}</span>
                            <span class="metric-value" style="color: ${data.net_income >= 0 ? '#10b981' : '#ef4444'};">${data.net_income >= 0 ? '' : '-'}${Math.abs(data.net_income).toLocaleString()} บาท</span>
                        </div>
                    </div>

                    <div class="card">
                        <h3>อัตราส่วนทางการเงิน (ปี ${year})</h3>
                        <div class="metric">
                            <span class="metric-label">Current Ratio</span>
                            <span class="metric-value">${data.current_ratio}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Quick Ratio</span>
                            <span class="metric-value">${data.quick_ratio}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Cash Ratio</span>
                            <span class="metric-value">${data.cash_ratio}</span>
                        </div>
                    </div>

                    <div class="card">
                        <h3>Working Capital</h3>
                        <div class="metric">
                            <span class="metric-label">ปี ${year}</span>
                            <span class="metric-value">${data.working_capital.toLocaleString()} บาท</span>
                        </div>
                    </div>
                `;
            }
        }

        // Element SDK implementation
        async function onConfigChange(config) {
            const hospitalName = config.hospital_name || defaultConfig.hospital_name;
            const dashboardTitle = config.dashboard_title || defaultConfig.dashboard_title;
            
            document.getElementById('hospital-name').textContent = hospitalName;
            document.getElementById('dashboard-title').textContent = dashboardTitle;
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [
                    {
                        get: () => config.primary_color || defaultConfig.primary_color,
                        set: (value) => {
                            config.primary_color = value;
                            window.elementSdk.setConfig({ primary_color: value });
                        }
                    },
                    {
                        get: () => config.secondary_color || defaultConfig.secondary_color,
                        set: (value) => {
                            config.secondary_color = value;
                            window.elementSdk.setConfig({ secondary_color: value });
                        }
                    },
                    {
                        get: () => config.background_color || defaultConfig.background_color,
                        set: (value) => {
                            config.background_color = value;
                            window.elementSdk.setConfig({ background_color: value });
                        }
                    },
                    {
                        get: () => config.text_color || defaultConfig.text_color,
                        set: (value) => {
                            config.text_color = value;
                            window.elementSdk.setConfig({ text_color: value });
                        }
                    },
                    {
                        get: () => config.accent_color || defaultConfig.accent_color,
                        set: (value) => {
                            config.accent_color = value;
                            window.elementSdk.setConfig({ accent_color: value });
                        }
                    }
                ],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["hospital_name", config.hospital_name || defaultConfig.hospital_name],
                ["dashboard_title", config.dashboard_title || defaultConfig.dashboard_title]
            ]);
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize first menu as active
            document.getElementById('overview-menu').classList.add('active');
            document.getElementById('overview-arrow').classList.add('rotated');
            document.querySelector('.menu-header').classList.add('active');
            
            // Initialize chart
            initChart();
            
            // Initialize Element SDK
            if (window.elementSdk) {
                window.elementSdk.init({
                    defaultConfig,
                    onConfigChange,
                    mapToCapabilities,
                    mapToEditPanelValues
                });
            }
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99814fbb729a731d',t:'MTc2MjA2MjE3Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
